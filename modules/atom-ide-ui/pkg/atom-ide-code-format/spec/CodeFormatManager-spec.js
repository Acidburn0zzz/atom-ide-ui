'use strict';

var cov_1w34b50ets = function () {
  var path = '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-code-format/spec/CodeFormatManager-spec.js',
      hash = '54a34624745ccb8511cf9ff9a6e5222b25f0ff04',
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-code-format/spec/CodeFormatManager-spec.js',
    statementMap: {
      '0': {
        start: {
          line: 18,
          column: 0
        },
        end: {
          line: 158,
          column: 3
        }
      },
      '1': {
        start: {
          line: 20,
          column: 2
        },
        end: {
          line: 26,
          column: 5
        }
      },
      '2': {
        start: {
          line: 21,
          column: 4
        },
        end: {
          line: 25,
          column: 7
        }
      },
      '3': {
        start: {
          line: 22,
          column: 6
        },
        end: {
          line: 22,
          column: 19
        }
      },
      '4': {
        start: {
          line: 23,
          column: 19
        },
        end: {
          line: 23,
          column: 34
        }
      },
      '5': {
        start: {
          line: 24,
          column: 6
        },
        end: {
          line: 24,
          column: 56
        }
      },
      '6': {
        start: {
          line: 28,
          column: 2
        },
        end: {
          line: 51,
          column: 5
        }
      },
      '7': {
        start: {
          line: 29,
          column: 4
        },
        end: {
          line: 50,
          column: 7
        }
      },
      '8': {
        start: {
          line: 30,
          column: 22
        },
        end: {
          line: 30,
          column: 45
        }
      },
      '9': {
        start: {
          line: 31,
          column: 6
        },
        end: {
          line: 42,
          column: 9
        }
      },
      '10': {
        start: {
          line: 35,
          column: 10
        },
        end: {
          line: 41,
          column: 12
        }
      },
      '11': {
        start: {
          line: 44,
          column: 6
        },
        end: {
          line: 44,
          column: 32
        }
      },
      '12': {
        start: {
          line: 45,
          column: 6
        },
        end: {
          line: 48,
          column: 8
        }
      },
      '13': {
        start: {
          line: 49,
          column: 6
        },
        end: {
          line: 49,
          column: 53
        }
      },
      '14': {
        start: {
          line: 49,
          column: 21
        },
        end: {
          line: 49,
          column: 51
        }
      },
      '15': {
        start: {
          line: 53,
          column: 2
        },
        end: {
          line: 69,
          column: 5
        }
      },
      '16': {
        start: {
          line: 54,
          column: 4
        },
        end: {
          line: 68,
          column: 7
        }
      },
      '17': {
        start: {
          line: 55,
          column: 22
        },
        end: {
          line: 55,
          column: 45
        }
      },
      '18': {
        start: {
          line: 56,
          column: 6
        },
        end: {
          line: 60,
          column: 9
        }
      },
      '19': {
        start: {
          line: 59,
          column: 32
        },
        end: {
          line: 59,
          column: 67
        }
      },
      '20': {
        start: {
          line: 62,
          column: 6
        },
        end: {
          line: 62,
          column: 32
        }
      },
      '21': {
        start: {
          line: 63,
          column: 6
        },
        end: {
          line: 66,
          column: 8
        }
      },
      '22': {
        start: {
          line: 67,
          column: 6
        },
        end: {
          line: 67,
          column: 53
        }
      },
      '23': {
        start: {
          line: 67,
          column: 21
        },
        end: {
          line: 67,
          column: 51
        }
      },
      '24': {
        start: {
          line: 71,
          column: 2
        },
        end: {
          line: 101,
          column: 5
        }
      },
      '25': {
        start: {
          line: 72,
          column: 4
        },
        end: {
          line: 100,
          column: 7
        }
      },
      '26': {
        start: {
          line: 73,
          column: 6
        },
        end: {
          line: 73,
          column: 55
        }
      },
      '27': {
        start: {
          line: 74,
          column: 22
        },
        end: {
          line: 74,
          column: 45
        }
      },
      '28': {
        start: {
          line: 75,
          column: 23
        },
        end: {
          line: 86,
          column: 7
        }
      },
      '29': {
        start: {
          line: 79,
          column: 10
        },
        end: {
          line: 85,
          column: 12
        }
      },
      '30': {
        start: {
          line: 87,
          column: 18
        },
        end: {
          line: 87,
          column: 70
        }
      },
      '31': {
        start: {
          line: 88,
          column: 6
        },
        end: {
          line: 88,
          column: 42
        }
      },
      '32': {
        start: {
          line: 90,
          column: 6
        },
        end: {
          line: 90,
          column: 30
        }
      },
      '33': {
        start: {
          line: 91,
          column: 6
        },
        end: {
          line: 91,
          column: 49
        }
      },
      '34': {
        start: {
          line: 92,
          column: 6
        },
        end: {
          line: 92,
          column: 33
        }
      },
      '35': {
        start: {
          line: 93,
          column: 6
        },
        end: {
          line: 93,
          column: 33
        }
      },
      '36': {
        start: {
          line: 95,
          column: 6
        },
        end: {
          line: 95,
          column: 53
        }
      },
      '37': {
        start: {
          line: 95,
          column: 21
        },
        end: {
          line: 95,
          column: 51
        }
      },
      '38': {
        start: {
          line: 96,
          column: 6
        },
        end: {
          line: 99,
          column: 9
        }
      },
      '39': {
        start: {
          line: 98,
          column: 8
        },
        end: {
          line: 98,
          column: 38
        }
      },
      '40': {
        start: {
          line: 103,
          column: 2
        },
        end: {
          line: 124,
          column: 5
        }
      },
      '41': {
        start: {
          line: 104,
          column: 4
        },
        end: {
          line: 123,
          column: 7
        }
      },
      '42': {
        start: {
          line: 105,
          column: 6
        },
        end: {
          line: 105,
          column: 55
        }
      },
      '43': {
        start: {
          line: 106,
          column: 22
        },
        end: {
          line: 106,
          column: 45
        }
      },
      '44': {
        start: {
          line: 107,
          column: 6
        },
        end: {
          line: 118,
          column: 9
        }
      },
      '45': {
        start: {
          line: 111,
          column: 10
        },
        end: {
          line: 117,
          column: 12
        }
      },
      '46': {
        start: {
          line: 120,
          column: 6
        },
        end: {
          line: 120,
          column: 32
        }
      },
      '47': {
        start: {
          line: 121,
          column: 6
        },
        end: {
          line: 121,
          column: 30
        }
      },
      '48': {
        start: {
          line: 122,
          column: 6
        },
        end: {
          line: 122,
          column: 47
        }
      },
      '49': {
        start: {
          line: 126,
          column: 2
        },
        end: {
          line: 157,
          column: 5
        }
      },
      '50': {
        start: {
          line: 127,
          column: 4
        },
        end: {
          line: 156,
          column: 7
        }
      },
      '51': {
        start: {
          line: 128,
          column: 6
        },
        end: {
          line: 128,
          column: 30
        }
      },
      '52': {
        start: {
          line: 129,
          column: 6
        },
        end: {
          line: 129,
          column: 55
        }
      },
      '53': {
        start: {
          line: 130,
          column: 22
        },
        end: {
          line: 130,
          column: 45
        }
      },
      '54': {
        start: {
          line: 131,
          column: 6
        },
        end: {
          line: 135,
          column: 9
        }
      },
      '55': {
        start: {
          line: 134,
          column: 26
        },
        end: {
          line: 134,
          column: 47
        }
      },
      '56': {
        start: {
          line: 137,
          column: 18
        },
        end: {
          line: 137,
          column: 72
        }
      },
      '57': {
        start: {
          line: 138,
          column: 6
        },
        end: {
          line: 138,
          column: 24
        }
      },
      '58': {
        start: {
          line: 139,
          column: 26
        },
        end: {
          line: 139,
          column: 60
        }
      },
      '59': {
        start: {
          line: 142,
          column: 6
        },
        end: {
          line: 142,
          column: 42
        }
      },
      '60': {
        start: {
          line: 142,
          column: 21
        },
        end: {
          line: 142,
          column: 40
        }
      },
      '61': {
        start: {
          line: 144,
          column: 6
        },
        end: {
          line: 146,
          column: 9
        }
      },
      '62': {
        start: {
          line: 145,
          column: 8
        },
        end: {
          line: 145,
          column: 33
        }
      },
      '63': {
        start: {
          line: 149,
          column: 6
        },
        end: {
          line: 149,
          column: 42
        }
      },
      '64': {
        start: {
          line: 149,
          column: 21
        },
        end: {
          line: 149,
          column: 40
        }
      },
      '65': {
        start: {
          line: 152,
          column: 6
        },
        end: {
          line: 152,
          column: 41
        }
      },
      '66': {
        start: {
          line: 152,
          column: 28
        },
        end: {
          line: 152,
          column: 39
        }
      },
      '67': {
        start: {
          line: 155,
          column: 6
        },
        end: {
          line: 155,
          column: 48
        }
      },
      '68': {
        start: {
          line: 155,
          column: 17
        },
        end: {
          line: 155,
          column: 46
        }
      }
    },
    fnMap: {
      '0': {
        name: '(anonymous_0)',
        decl: {
          start: {
            line: 18,
            column: 30
          },
          end: {
            line: 18,
            column: 31
          }
        },
        loc: {
          start: {
            line: 18,
            column: 36
          },
          end: {
            line: 158,
            column: 1
          }
        },
        line: 18
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 20,
            column: 13
          },
          end: {
            line: 20,
            column: 14
          }
        },
        loc: {
          start: {
            line: 20,
            column: 19
          },
          end: {
            line: 26,
            column: 3
          }
        },
        line: 20
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 21,
            column: 20
          },
          end: {
            line: 21,
            column: 21
          }
        },
        loc: {
          start: {
            line: 21,
            column: 32
          },
          end: {
            line: 25,
            column: 5
          }
        },
        line: 21
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 28,
            column: 37
          },
          end: {
            line: 28,
            column: 38
          }
        },
        loc: {
          start: {
            line: 28,
            column: 43
          },
          end: {
            line: 51,
            column: 3
          }
        },
        line: 28
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 29,
            column: 20
          },
          end: {
            line: 29,
            column: 21
          }
        },
        loc: {
          start: {
            line: 29,
            column: 32
          },
          end: {
            line: 50,
            column: 5
          }
        },
        line: 29
      },
      '5': {
        name: '(anonymous_5)',
        decl: {
          start: {
            line: 34,
            column: 20
          },
          end: {
            line: 34,
            column: 21
          }
        },
        loc: {
          start: {
            line: 35,
            column: 10
          },
          end: {
            line: 41,
            column: 12
          }
        },
        line: 35
      },
      '6': {
        name: '(anonymous_6)',
        decl: {
          start: {
            line: 49,
            column: 15
          },
          end: {
            line: 49,
            column: 16
          }
        },
        loc: {
          start: {
            line: 49,
            column: 21
          },
          end: {
            line: 49,
            column: 51
          }
        },
        line: 49
      },
      '7': {
        name: '(anonymous_7)',
        decl: {
          start: {
            line: 53,
            column: 48
          },
          end: {
            line: 53,
            column: 49
          }
        },
        loc: {
          start: {
            line: 53,
            column: 54
          },
          end: {
            line: 69,
            column: 3
          }
        },
        line: 53
      },
      '8': {
        name: '(anonymous_8)',
        decl: {
          start: {
            line: 54,
            column: 20
          },
          end: {
            line: 54,
            column: 21
          }
        },
        loc: {
          start: {
            line: 54,
            column: 32
          },
          end: {
            line: 68,
            column: 5
          }
        },
        line: 54
      },
      '9': {
        name: '(anonymous_9)',
        decl: {
          start: {
            line: 59,
            column: 26
          },
          end: {
            line: 59,
            column: 27
          }
        },
        loc: {
          start: {
            line: 59,
            column: 32
          },
          end: {
            line: 59,
            column: 67
          }
        },
        line: 59
      },
      '10': {
        name: '(anonymous_10)',
        decl: {
          start: {
            line: 67,
            column: 15
          },
          end: {
            line: 67,
            column: 16
          }
        },
        loc: {
          start: {
            line: 67,
            column: 21
          },
          end: {
            line: 67,
            column: 51
          }
        },
        line: 67
      },
      '11': {
        name: '(anonymous_11)',
        decl: {
          start: {
            line: 71,
            column: 34
          },
          end: {
            line: 71,
            column: 35
          }
        },
        loc: {
          start: {
            line: 71,
            column: 40
          },
          end: {
            line: 101,
            column: 3
          }
        },
        line: 71
      },
      '12': {
        name: '(anonymous_12)',
        decl: {
          start: {
            line: 72,
            column: 20
          },
          end: {
            line: 72,
            column: 21
          }
        },
        loc: {
          start: {
            line: 72,
            column: 32
          },
          end: {
            line: 100,
            column: 5
          }
        },
        line: 72
      },
      '13': {
        name: '(anonymous_13)',
        decl: {
          start: {
            line: 78,
            column: 26
          },
          end: {
            line: 78,
            column: 27
          }
        },
        loc: {
          start: {
            line: 79,
            column: 10
          },
          end: {
            line: 85,
            column: 12
          }
        },
        line: 79
      },
      '14': {
        name: '(anonymous_14)',
        decl: {
          start: {
            line: 95,
            column: 15
          },
          end: {
            line: 95,
            column: 16
          }
        },
        loc: {
          start: {
            line: 95,
            column: 21
          },
          end: {
            line: 95,
            column: 51
          }
        },
        line: 95
      },
      '15': {
        name: '(anonymous_15)',
        decl: {
          start: {
            line: 96,
            column: 11
          },
          end: {
            line: 96,
            column: 12
          }
        },
        loc: {
          start: {
            line: 96,
            column: 17
          },
          end: {
            line: 99,
            column: 7
          }
        },
        line: 96
      },
      '16': {
        name: '(anonymous_16)',
        decl: {
          start: {
            line: 103,
            column: 34
          },
          end: {
            line: 103,
            column: 35
          }
        },
        loc: {
          start: {
            line: 103,
            column: 40
          },
          end: {
            line: 124,
            column: 3
          }
        },
        line: 103
      },
      '17': {
        name: '(anonymous_17)',
        decl: {
          start: {
            line: 104,
            column: 20
          },
          end: {
            line: 104,
            column: 21
          }
        },
        loc: {
          start: {
            line: 104,
            column: 32
          },
          end: {
            line: 123,
            column: 5
          }
        },
        line: 104
      },
      '18': {
        name: '(anonymous_18)',
        decl: {
          start: {
            line: 110,
            column: 22
          },
          end: {
            line: 110,
            column: 23
          }
        },
        loc: {
          start: {
            line: 111,
            column: 10
          },
          end: {
            line: 117,
            column: 12
          }
        },
        line: 111
      },
      '19': {
        name: '(anonymous_19)',
        decl: {
          start: {
            line: 126,
            column: 37
          },
          end: {
            line: 126,
            column: 38
          }
        },
        loc: {
          start: {
            line: 126,
            column: 43
          },
          end: {
            line: 157,
            column: 3
          }
        },
        line: 126
      },
      '20': {
        name: '(anonymous_20)',
        decl: {
          start: {
            line: 127,
            column: 20
          },
          end: {
            line: 127,
            column: 21
          }
        },
        loc: {
          start: {
            line: 127,
            column: 32
          },
          end: {
            line: 156,
            column: 5
          }
        },
        line: 127
      },
      '21': {
        name: '(anonymous_21)',
        decl: {
          start: {
            line: 134,
            column: 20
          },
          end: {
            line: 134,
            column: 21
          }
        },
        loc: {
          start: {
            line: 134,
            column: 26
          },
          end: {
            line: 134,
            column: 47
          }
        },
        line: 134
      },
      '22': {
        name: '(anonymous_22)',
        decl: {
          start: {
            line: 134,
            column: 38
          },
          end: {
            line: 134,
            column: 39
          }
        },
        loc: {
          start: {
            line: 134,
            column: 44
          },
          end: {
            line: 134,
            column: 46
          }
        },
        line: 134
      },
      '23': {
        name: '(anonymous_23)',
        decl: {
          start: {
            line: 142,
            column: 15
          },
          end: {
            line: 142,
            column: 16
          }
        },
        loc: {
          start: {
            line: 142,
            column: 21
          },
          end: {
            line: 142,
            column: 40
          }
        },
        line: 142
      },
      '24': {
        name: '(anonymous_24)',
        decl: {
          start: {
            line: 144,
            column: 11
          },
          end: {
            line: 144,
            column: 12
          }
        },
        loc: {
          start: {
            line: 144,
            column: 17
          },
          end: {
            line: 146,
            column: 7
          }
        },
        line: 144
      },
      '25': {
        name: '(anonymous_25)',
        decl: {
          start: {
            line: 149,
            column: 15
          },
          end: {
            line: 149,
            column: 16
          }
        },
        loc: {
          start: {
            line: 149,
            column: 21
          },
          end: {
            line: 149,
            column: 40
          }
        },
        line: 149
      },
      '26': {
        name: '(anonymous_26)',
        decl: {
          start: {
            line: 152,
            column: 22
          },
          end: {
            line: 152,
            column: 23
          }
        },
        loc: {
          start: {
            line: 152,
            column: 28
          },
          end: {
            line: 152,
            column: 39
          }
        },
        line: 152
      },
      '27': {
        name: '(anonymous_27)',
        decl: {
          start: {
            line: 155,
            column: 11
          },
          end: {
            line: 155,
            column: 12
          }
        },
        loc: {
          start: {
            line: 155,
            column: 17
          },
          end: {
            line: 155,
            column: 46
          }
        },
        line: 155
      }
    },
    branchMap: {},
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0,
      '33': 0,
      '34': 0,
      '35': 0,
      '36': 0,
      '37': 0,
      '38': 0,
      '39': 0,
      '40': 0,
      '41': 0,
      '42': 0,
      '43': 0,
      '44': 0,
      '45': 0,
      '46': 0,
      '47': 0,
      '48': 0,
      '49': 0,
      '50': 0,
      '51': 0,
      '52': 0,
      '53': 0,
      '54': 0,
      '55': 0,
      '56': 0,
      '57': 0,
      '58': 0,
      '59': 0,
      '60': 0,
      '61': 0,
      '62': 0,
      '63': 0,
      '64': 0,
      '65': 0,
      '66': 0,
      '67': 0,
      '68': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0
    },
    b: {},
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

var _asyncToGenerator = _interopRequireDefault(require('async-to-generator'));

var _atom = require('atom');

var _temp;

function _load_temp() {
  return _temp = _interopRequireDefault(require('temp'));
}

var _config;

function _load_config() {
  return _config = _interopRequireWildcard(require('../lib/config'));
}

var _CodeFormatManager;

function _load_CodeFormatManager() {
  return _CodeFormatManager = _interopRequireDefault(require('../lib/CodeFormatManager'));
}

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */

cov_1w34b50ets.s[0]++;


describe('CodeFormatManager', () => {
  cov_1w34b50ets.f[0]++;

  let textEditor;
  cov_1w34b50ets.s[1]++;
  beforeEach(() => {
    cov_1w34b50ets.f[1]++;
    cov_1w34b50ets.s[2]++;

    waitsForPromise((0, _asyncToGenerator.default)(function* () {
      cov_1w34b50ets.f[2]++;
      cov_1w34b50ets.s[3]++;

      (_temp || _load_temp()).default.track();
      const file = (cov_1w34b50ets.s[4]++, (_temp || _load_temp()).default.openSync());
      cov_1w34b50ets.s[5]++;
      textEditor = yield atom.workspace.open(file.path);
    }));
  });

  cov_1w34b50ets.s[6]++;
  it('formats an editor on request', () => {
    cov_1w34b50ets.f[3]++;
    cov_1w34b50ets.s[7]++;

    waitsForPromise((0, _asyncToGenerator.default)(function* () {
      cov_1w34b50ets.f[4]++;

      const manager = (cov_1w34b50ets.s[8]++, new (_CodeFormatManager || _load_CodeFormatManager()).default());
      cov_1w34b50ets.s[9]++;
      manager.addRangeProvider({
        grammarScopes: ['text.plain.null-grammar'],
        priority: 1,
        formatCode: function () {
          cov_1w34b50ets.f[5]++;
          cov_1w34b50ets.s[10]++;
          return Promise.resolve([{
            oldRange: new _atom.Range([0, 0], [0, 3]),
            oldText: 'abc',
            newText: 'def'
          }]);
        }
      });

      cov_1w34b50ets.s[11]++;
      textEditor.setText('abc');
      cov_1w34b50ets.s[12]++;
      atom.commands.dispatch(atom.views.getView(textEditor), 'code-format:format-code');
      cov_1w34b50ets.s[13]++;
      waitsFor(function () {
        cov_1w34b50ets.f[6]++;
        cov_1w34b50ets.s[14]++;
        return textEditor.getText() === 'def';
      });
    }));
  });

  cov_1w34b50ets.s[15]++;
  it('format an editor using formatEntireFile', () => {
    cov_1w34b50ets.f[7]++;
    cov_1w34b50ets.s[16]++;

    waitsForPromise((0, _asyncToGenerator.default)(function* () {
      cov_1w34b50ets.f[8]++;

      const manager = (cov_1w34b50ets.s[17]++, new (_CodeFormatManager || _load_CodeFormatManager()).default());
      cov_1w34b50ets.s[18]++;
      manager.addFileProvider({
        grammarScopes: ['text.plain.null-grammar'],
        priority: 1,
        formatEntireFile: function () {
          cov_1w34b50ets.f[9]++;
          cov_1w34b50ets.s[19]++;
          return Promise.resolve({ formatted: 'ghi' });
        }
      });

      cov_1w34b50ets.s[20]++;
      textEditor.setText('abc');
      cov_1w34b50ets.s[21]++;
      atom.commands.dispatch(atom.views.getView(textEditor), 'code-format:format-code');
      cov_1w34b50ets.s[22]++;
      waitsFor(function () {
        cov_1w34b50ets.f[10]++;
        cov_1w34b50ets.s[23]++;
        return textEditor.getText() === 'ghi';
      });
    }));
  });

  cov_1w34b50ets.s[24]++;
  it('formats an editor on type', () => {
    cov_1w34b50ets.f[11]++;
    cov_1w34b50ets.s[25]++;

    waitsForPromise((0, _asyncToGenerator.default)(function* () {
      cov_1w34b50ets.f[12]++;
      cov_1w34b50ets.s[26]++;

      spyOn(_config || _load_config(), 'getFormatOnType').andReturn(true);
      const manager = (cov_1w34b50ets.s[27]++, new (_CodeFormatManager || _load_CodeFormatManager()).default());
      const provider = (cov_1w34b50ets.s[28]++, {
        grammarScopes: ['text.plain.null-grammar'],
        priority: 1,
        formatAtPosition: function () {
          cov_1w34b50ets.f[13]++;
          cov_1w34b50ets.s[29]++;
          return Promise.resolve([{
            oldRange: new _atom.Range([0, 0], [0, 3]),
            oldText: 'abc',
            newText: 'def'
          }]);
        }
      });
      const spy = (cov_1w34b50ets.s[30]++, spyOn(provider, 'formatAtPosition').andCallThrough());
      cov_1w34b50ets.s[31]++;
      manager.addOnTypeProvider(provider);

      cov_1w34b50ets.s[32]++;
      textEditor.setText('a');
      cov_1w34b50ets.s[33]++;
      textEditor.setCursorBufferPosition([0, 1]);
      cov_1w34b50ets.s[34]++;
      textEditor.insertText('b');
      cov_1w34b50ets.s[35]++;
      textEditor.insertText('c');

      cov_1w34b50ets.s[36]++;
      waitsFor(function () {
        cov_1w34b50ets.f[14]++;
        cov_1w34b50ets.s[37]++;
        return textEditor.getText() === 'def';
      });
      cov_1w34b50ets.s[38]++;
      runs(function () {
        cov_1w34b50ets.f[15]++;
        cov_1w34b50ets.s[39]++;

        // Debouncing should ensure only one format call.
        expect(spy.callCount).toBe(1);
      });
    }));
  });

  cov_1w34b50ets.s[40]++;
  it('formats an editor on save', () => {
    cov_1w34b50ets.f[16]++;
    cov_1w34b50ets.s[41]++;

    waitsForPromise((0, _asyncToGenerator.default)(function* () {
      cov_1w34b50ets.f[17]++;
      cov_1w34b50ets.s[42]++;

      spyOn(_config || _load_config(), 'getFormatOnSave').andReturn(true);
      const manager = (cov_1w34b50ets.s[43]++, new (_CodeFormatManager || _load_CodeFormatManager()).default());
      cov_1w34b50ets.s[44]++;
      manager.addOnSaveProvider({
        grammarScopes: ['text.plain.null-grammar'],
        priority: 1,
        formatOnSave: function () {
          cov_1w34b50ets.f[18]++;
          cov_1w34b50ets.s[45]++;
          return Promise.resolve([{
            oldRange: new _atom.Range([0, 0], [0, 3]),
            oldText: 'abc',
            newText: 'def'
          }]);
        }
      });

      cov_1w34b50ets.s[46]++;
      textEditor.setText('abc');
      cov_1w34b50ets.s[47]++;
      yield textEditor.save();
      cov_1w34b50ets.s[48]++;
      expect(textEditor.getText()).toBe('def');
    }));
  });

  cov_1w34b50ets.s[49]++;
  it('should still save on timeout', () => {
    cov_1w34b50ets.f[19]++;
    cov_1w34b50ets.s[50]++;

    waitsForPromise((0, _asyncToGenerator.default)(function* () {
      cov_1w34b50ets.f[20]++;
      cov_1w34b50ets.s[51]++;

      jasmine.Clock.useMock();
      cov_1w34b50ets.s[52]++;
      spyOn(_config || _load_config(), 'getFormatOnSave').andReturn(true);
      const manager = (cov_1w34b50ets.s[53]++, new (_CodeFormatManager || _load_CodeFormatManager()).default());
      cov_1w34b50ets.s[54]++;
      manager.addRangeProvider({
        grammarScopes: ['text.plain.null-grammar'],
        priority: 1,
        formatCode: function () {
          cov_1w34b50ets.f[21]++;
          cov_1w34b50ets.s[55]++;
          return new Promise(function () {
            cov_1w34b50ets.f[22]++;
          });
        }
      });

      const spy = (cov_1w34b50ets.s[56]++, spyOn(textEditor.getBuffer(), 'save').andCallThrough());
      cov_1w34b50ets.s[57]++;
      textEditor.save();
      const savePromise = (cov_1w34b50ets.s[58]++, Promise.resolve(textEditor.save()));

      // The first save should be pushed through after the 2nd.
      cov_1w34b50ets.s[59]++;
      waitsFor(function () {
        cov_1w34b50ets.f[23]++;
        cov_1w34b50ets.s[60]++;
        return spy.callCount === 1;
      });

      cov_1w34b50ets.s[61]++;
      runs(function () {
        cov_1w34b50ets.f[24]++;
        cov_1w34b50ets.s[62]++;

        jasmine.Clock.tick(3000);
      });

      // Hitting the timeout will force the 2nd save through.
      cov_1w34b50ets.s[63]++;
      waitsFor(function () {
        cov_1w34b50ets.f[25]++;
        cov_1w34b50ets.s[64]++;
        return spy.callCount === 2;
      });

      // The real save should still go through.
      cov_1w34b50ets.s[65]++;
      waitsForPromise(function () {
        cov_1w34b50ets.f[26]++;
        cov_1w34b50ets.s[66]++;
        return savePromise;
      });

      // Sanity check.
      cov_1w34b50ets.s[67]++;
      runs(function () {
        cov_1w34b50ets.f[27]++;
        cov_1w34b50ets.s[68]++;
        return expect(spy.callCount).toBe(2);
      });
    }));
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNvZGVGb3JtYXRNYW5hZ2VyLXNwZWMuanMiXSwibmFtZXMiOlsiZGVzY3JpYmUiLCJ0ZXh0RWRpdG9yIiwiYmVmb3JlRWFjaCIsIndhaXRzRm9yUHJvbWlzZSIsInRyYWNrIiwiZmlsZSIsIm9wZW5TeW5jIiwiYXRvbSIsIndvcmtzcGFjZSIsIm9wZW4iLCJwYXRoIiwiaXQiLCJtYW5hZ2VyIiwiYWRkUmFuZ2VQcm92aWRlciIsImdyYW1tYXJTY29wZXMiLCJwcmlvcml0eSIsImZvcm1hdENvZGUiLCJyZXNvbHZlIiwib2xkUmFuZ2UiLCJvbGRUZXh0IiwibmV3VGV4dCIsInNldFRleHQiLCJjb21tYW5kcyIsImRpc3BhdGNoIiwidmlld3MiLCJnZXRWaWV3Iiwid2FpdHNGb3IiLCJnZXRUZXh0IiwiYWRkRmlsZVByb3ZpZGVyIiwiZm9ybWF0RW50aXJlRmlsZSIsImZvcm1hdHRlZCIsInNweU9uIiwiYW5kUmV0dXJuIiwicHJvdmlkZXIiLCJmb3JtYXRBdFBvc2l0aW9uIiwic3B5IiwiYW5kQ2FsbFRocm91Z2giLCJhZGRPblR5cGVQcm92aWRlciIsInNldEN1cnNvckJ1ZmZlclBvc2l0aW9uIiwiaW5zZXJ0VGV4dCIsInJ1bnMiLCJleHBlY3QiLCJjYWxsQ291bnQiLCJ0b0JlIiwiYWRkT25TYXZlUHJvdmlkZXIiLCJmb3JtYXRPblNhdmUiLCJzYXZlIiwiamFzbWluZSIsIkNsb2NrIiwidXNlTW9jayIsIlByb21pc2UiLCJnZXRCdWZmZXIiLCJzYXZlUHJvbWlzZSIsInRpY2siXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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Qyx1QkFBZSxDQUFDLHlCQUFELENBRFE7QUFFdkJDLGtCQUFVLENBRmE7QUFHdkJDLG9CQUFZLFlBQU07QUFBQTtBQUFBO0FBQUEscUJBQUlrQyxPQUFKLENBQVksWUFBTTtBQUFBO0FBQUUsV0FBcEI7QUFBcUI7QUFIaEIsT0FBekI7O0FBTUEsWUFBTWYsK0JBQU1KLE1BQU05QixXQUFXa0QsU0FBWCxFQUFOLEVBQThCLE1BQTlCLEVBQXNDZixjQUF0QyxFQUFOLENBQU47QUFWMEI7QUFXMUJuQyxpQkFBVzZDLElBQVg7QUFDQSxZQUFNTSx1Q0FBY0YsUUFBUWpDLE9BQVIsQ0FBZ0JoQixXQUFXNkMsSUFBWCxFQUFoQixDQUFkLENBQU47O0FBRUE7QUFkMEI7QUFlMUJwQixlQUFTLFlBQU07QUFBQTtBQUFBO0FBQUEsbUJBQUlnQixTQUFKLEtBQWtCLENBQWxCO0FBQW1CLE9BQWxDOztBQWYwQjtBQWlCMUJGLFdBQUssWUFBTTtBQUFBO0FBQUE7O0FBQ1RPLGdCQUFRQyxLQUFSLENBQWNLLElBQWQsQ0FBbUIsSUFBbkI7QUFDRCxPQUZEOztBQUlBO0FBckIwQjtBQXNCMUIzQixlQUFTLFlBQU07QUFBQTtBQUFBO0FBQUEsbUJBQUlnQixTQUFKLEtBQWtCLENBQWxCO0FBQW1CLE9BQWxDOztBQUVBO0FBeEIwQjtBQXlCMUJ2QyxzQkFBZ0IsWUFBTWlEO0FBQUFBO0FBQUFBO0FBQUFBO0FBQVdBLE9BQWpDOztBQUVBO0FBM0IwQjtBQTRCMUJaLFdBQUssWUFBTTtBQUFBO0FBQUE7QUFBQSxzQkFBT0wsSUFBSU8sU0FBWCxFQUFzQkMsSUFBdEIsQ0FBMkIsQ0FBM0I7QUFBNkIsT0FBeEM7QUFDRCxLQTdCRDtBQThCRCxHQS9CRDtBQWdDRCxDQTVJRCIsImZpbGUiOiJDb2RlRm9ybWF0TWFuYWdlci1zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTctcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuIEFuIGFkZGl0aW9uYWwgZ3JhbnRcbiAqIG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5LlxuICpcbiAqIEBmbG93XG4gKiBAZm9ybWF0XG4gKi9cblxuaW1wb3J0IHtSYW5nZX0gZnJvbSAnYXRvbSc7XG5pbXBvcnQgdGVtcCBmcm9tICd0ZW1wJztcbmltcG9ydCAqIGFzIGNvbmZpZyBmcm9tICcuLi9saWIvY29uZmlnJztcbmltcG9ydCBDb2RlRm9ybWF0TWFuYWdlciBmcm9tICcuLi9saWIvQ29kZUZvcm1hdE1hbmFnZXInO1xuXG5kZXNjcmliZSgnQ29kZUZvcm1hdE1hbmFnZXInLCAoKSA9PiB7XG4gIGxldCB0ZXh0RWRpdG9yO1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICB3YWl0c0ZvclByb21pc2UoYXN5bmMgKCkgPT4ge1xuICAgICAgdGVtcC50cmFjaygpO1xuICAgICAgY29uc3QgZmlsZSA9IHRlbXAub3BlblN5bmMoKTtcbiAgICAgIHRleHRFZGl0b3IgPSBhd2FpdCBhdG9tLndvcmtzcGFjZS5vcGVuKGZpbGUucGF0aCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGl0KCdmb3JtYXRzIGFuIGVkaXRvciBvbiByZXF1ZXN0JywgKCkgPT4ge1xuICAgIHdhaXRzRm9yUHJvbWlzZShhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtYW5hZ2VyID0gbmV3IENvZGVGb3JtYXRNYW5hZ2VyKCk7XG4gICAgICBtYW5hZ2VyLmFkZFJhbmdlUHJvdmlkZXIoe1xuICAgICAgICBncmFtbWFyU2NvcGVzOiBbJ3RleHQucGxhaW4ubnVsbC1ncmFtbWFyJ10sXG4gICAgICAgIHByaW9yaXR5OiAxLFxuICAgICAgICBmb3JtYXRDb2RlOiAoKSA9PlxuICAgICAgICAgIFByb21pc2UucmVzb2x2ZShbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG9sZFJhbmdlOiBuZXcgUmFuZ2UoWzAsIDBdLCBbMCwgM10pLFxuICAgICAgICAgICAgICBvbGRUZXh0OiAnYWJjJyxcbiAgICAgICAgICAgICAgbmV3VGV4dDogJ2RlZicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0pLFxuICAgICAgfSk7XG5cbiAgICAgIHRleHRFZGl0b3Iuc2V0VGV4dCgnYWJjJyk7XG4gICAgICBhdG9tLmNvbW1hbmRzLmRpc3BhdGNoKFxuICAgICAgICBhdG9tLnZpZXdzLmdldFZpZXcodGV4dEVkaXRvciksXG4gICAgICAgICdjb2RlLWZvcm1hdDpmb3JtYXQtY29kZScsXG4gICAgICApO1xuICAgICAgd2FpdHNGb3IoKCkgPT4gdGV4dEVkaXRvci5nZXRUZXh0KCkgPT09ICdkZWYnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgaXQoJ2Zvcm1hdCBhbiBlZGl0b3IgdXNpbmcgZm9ybWF0RW50aXJlRmlsZScsICgpID0+IHtcbiAgICB3YWl0c0ZvclByb21pc2UoYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbWFuYWdlciA9IG5ldyBDb2RlRm9ybWF0TWFuYWdlcigpO1xuICAgICAgbWFuYWdlci5hZGRGaWxlUHJvdmlkZXIoe1xuICAgICAgICBncmFtbWFyU2NvcGVzOiBbJ3RleHQucGxhaW4ubnVsbC1ncmFtbWFyJ10sXG4gICAgICAgIHByaW9yaXR5OiAxLFxuICAgICAgICBmb3JtYXRFbnRpcmVGaWxlOiAoKSA9PiBQcm9taXNlLnJlc29sdmUoe2Zvcm1hdHRlZDogJ2doaSd9KSxcbiAgICAgIH0pO1xuXG4gICAgICB0ZXh0RWRpdG9yLnNldFRleHQoJ2FiYycpO1xuICAgICAgYXRvbS5jb21tYW5kcy5kaXNwYXRjaChcbiAgICAgICAgYXRvbS52aWV3cy5nZXRWaWV3KHRleHRFZGl0b3IpLFxuICAgICAgICAnY29kZS1mb3JtYXQ6Zm9ybWF0LWNvZGUnLFxuICAgICAgKTtcbiAgICAgIHdhaXRzRm9yKCgpID0+IHRleHRFZGl0b3IuZ2V0VGV4dCgpID09PSAnZ2hpJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGl0KCdmb3JtYXRzIGFuIGVkaXRvciBvbiB0eXBlJywgKCkgPT4ge1xuICAgIHdhaXRzRm9yUHJvbWlzZShhc3luYyAoKSA9PiB7XG4gICAgICBzcHlPbihjb25maWcsICdnZXRGb3JtYXRPblR5cGUnKS5hbmRSZXR1cm4odHJ1ZSk7XG4gICAgICBjb25zdCBtYW5hZ2VyID0gbmV3IENvZGVGb3JtYXRNYW5hZ2VyKCk7XG4gICAgICBjb25zdCBwcm92aWRlciA9IHtcbiAgICAgICAgZ3JhbW1hclNjb3BlczogWyd0ZXh0LnBsYWluLm51bGwtZ3JhbW1hciddLFxuICAgICAgICBwcmlvcml0eTogMSxcbiAgICAgICAgZm9ybWF0QXRQb3NpdGlvbjogKCkgPT5cbiAgICAgICAgICBQcm9taXNlLnJlc29sdmUoW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBvbGRSYW5nZTogbmV3IFJhbmdlKFswLCAwXSwgWzAsIDNdKSxcbiAgICAgICAgICAgICAgb2xkVGV4dDogJ2FiYycsXG4gICAgICAgICAgICAgIG5ld1RleHQ6ICdkZWYnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdKSxcbiAgICAgIH07XG4gICAgICBjb25zdCBzcHkgPSBzcHlPbihwcm92aWRlciwgJ2Zvcm1hdEF0UG9zaXRpb24nKS5hbmRDYWxsVGhyb3VnaCgpO1xuICAgICAgbWFuYWdlci5hZGRPblR5cGVQcm92aWRlcihwcm92aWRlcik7XG5cbiAgICAgIHRleHRFZGl0b3Iuc2V0VGV4dCgnYScpO1xuICAgICAgdGV4dEVkaXRvci5zZXRDdXJzb3JCdWZmZXJQb3NpdGlvbihbMCwgMV0pO1xuICAgICAgdGV4dEVkaXRvci5pbnNlcnRUZXh0KCdiJyk7XG4gICAgICB0ZXh0RWRpdG9yLmluc2VydFRleHQoJ2MnKTtcblxuICAgICAgd2FpdHNGb3IoKCkgPT4gdGV4dEVkaXRvci5nZXRUZXh0KCkgPT09ICdkZWYnKTtcbiAgICAgIHJ1bnMoKCkgPT4ge1xuICAgICAgICAvLyBEZWJvdW5jaW5nIHNob3VsZCBlbnN1cmUgb25seSBvbmUgZm9ybWF0IGNhbGwuXG4gICAgICAgIGV4cGVjdChzcHkuY2FsbENvdW50KS50b0JlKDEpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGl0KCdmb3JtYXRzIGFuIGVkaXRvciBvbiBzYXZlJywgKCkgPT4ge1xuICAgIHdhaXRzRm9yUHJvbWlzZShhc3luYyAoKSA9PiB7XG4gICAgICBzcHlPbihjb25maWcsICdnZXRGb3JtYXRPblNhdmUnKS5hbmRSZXR1cm4odHJ1ZSk7XG4gICAgICBjb25zdCBtYW5hZ2VyID0gbmV3IENvZGVGb3JtYXRNYW5hZ2VyKCk7XG4gICAgICBtYW5hZ2VyLmFkZE9uU2F2ZVByb3ZpZGVyKHtcbiAgICAgICAgZ3JhbW1hclNjb3BlczogWyd0ZXh0LnBsYWluLm51bGwtZ3JhbW1hciddLFxuICAgICAgICBwcmlvcml0eTogMSxcbiAgICAgICAgZm9ybWF0T25TYXZlOiAoKSA9PlxuICAgICAgICAgIFByb21pc2UucmVzb2x2ZShbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG9sZFJhbmdlOiBuZXcgUmFuZ2UoWzAsIDBdLCBbMCwgM10pLFxuICAgICAgICAgICAgICBvbGRUZXh0OiAnYWJjJyxcbiAgICAgICAgICAgICAgbmV3VGV4dDogJ2RlZicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0pLFxuICAgICAgfSk7XG5cbiAgICAgIHRleHRFZGl0b3Iuc2V0VGV4dCgnYWJjJyk7XG4gICAgICBhd2FpdCB0ZXh0RWRpdG9yLnNhdmUoKTtcbiAgICAgIGV4cGVjdCh0ZXh0RWRpdG9yLmdldFRleHQoKSkudG9CZSgnZGVmJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgc3RpbGwgc2F2ZSBvbiB0aW1lb3V0JywgKCkgPT4ge1xuICAgIHdhaXRzRm9yUHJvbWlzZShhc3luYyAoKSA9PiB7XG4gICAgICBqYXNtaW5lLkNsb2NrLnVzZU1vY2soKTtcbiAgICAgIHNweU9uKGNvbmZpZywgJ2dldEZvcm1hdE9uU2F2ZScpLmFuZFJldHVybih0cnVlKTtcbiAgICAgIGNvbnN0IG1hbmFnZXIgPSBuZXcgQ29kZUZvcm1hdE1hbmFnZXIoKTtcbiAgICAgIG1hbmFnZXIuYWRkUmFuZ2VQcm92aWRlcih7XG4gICAgICAgIGdyYW1tYXJTY29wZXM6IFsndGV4dC5wbGFpbi5udWxsLWdyYW1tYXInXSxcbiAgICAgICAgcHJpb3JpdHk6IDEsXG4gICAgICAgIGZvcm1hdENvZGU6ICgpID0+IG5ldyBQcm9taXNlKCgpID0+IHt9KSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBzcHkgPSBzcHlPbih0ZXh0RWRpdG9yLmdldEJ1ZmZlcigpLCAnc2F2ZScpLmFuZENhbGxUaHJvdWdoKCk7XG4gICAgICB0ZXh0RWRpdG9yLnNhdmUoKTtcbiAgICAgIGNvbnN0IHNhdmVQcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKHRleHRFZGl0b3Iuc2F2ZSgpKTtcblxuICAgICAgLy8gVGhlIGZpcnN0IHNhdmUgc2hvdWxkIGJlIHB1c2hlZCB0aHJvdWdoIGFmdGVyIHRoZSAybmQuXG4gICAgICB3YWl0c0ZvcigoKSA9PiBzcHkuY2FsbENvdW50ID09PSAxKTtcblxuICAgICAgcnVucygoKSA9PiB7XG4gICAgICAgIGphc21pbmUuQ2xvY2sudGljaygzMDAwKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBIaXR0aW5nIHRoZSB0aW1lb3V0IHdpbGwgZm9yY2UgdGhlIDJuZCBzYXZlIHRocm91Z2guXG4gICAgICB3YWl0c0ZvcigoKSA9PiBzcHkuY2FsbENvdW50ID09PSAyKTtcblxuICAgICAgLy8gVGhlIHJlYWwgc2F2ZSBzaG91bGQgc3RpbGwgZ28gdGhyb3VnaC5cbiAgICAgIHdhaXRzRm9yUHJvbWlzZSgoKSA9PiBzYXZlUHJvbWlzZSk7XG5cbiAgICAgIC8vIFNhbml0eSBjaGVjay5cbiAgICAgIHJ1bnMoKCkgPT4gZXhwZWN0KHNweS5jYWxsQ291bnQpLnRvQmUoMikpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19