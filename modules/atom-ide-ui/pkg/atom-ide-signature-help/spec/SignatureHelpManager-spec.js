'use strict';

var cov_1qr5v5ar19 = function () {
  var path = '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-signature-help/spec/SignatureHelpManager-spec.js',
      hash = '1e45df9f36465a046bf8f2085d056cf22d89533f',
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-signature-help/spec/SignatureHelpManager-spec.js',
    statementMap: {
      '0': {
        start: {
          line: 21,
          column: 0
        },
        end: {
          line: 175,
          column: 3
        }
      },
      '1': {
        start: {
          line: 26,
          column: 2
        },
        end: {
          line: 62,
          column: 5
        }
      },
      '2': {
        start: {
          line: 27,
          column: 4
        },
        end: {
          line: 27,
          column: 29
        }
      },
      '3': {
        start: {
          line: 28,
          column: 4
        },
        end: {
          line: 28,
          column: 28
        }
      },
      '4': {
        start: {
          line: 29,
          column: 4
        },
        end: {
          line: 29,
          column: 61
        }
      },
      '5': {
        start: {
          line: 31,
          column: 4
        },
        end: {
          line: 46,
          column: 6
        }
      },
      '6': {
        start: {
          line: 47,
          column: 4
        },
        end: {
          line: 57,
          column: 6
        }
      },
      '7': {
        start: {
          line: 49,
          column: 8
        },
        end: {
          line: 49,
          column: 22
        }
      },
      '8': {
        start: {
          line: 52,
          column: 8
        },
        end: {
          line: 52,
          column: 22
        }
      },
      '9': {
        start: {
          line: 58,
          column: 4
        },
        end: {
          line: 60,
          column: 7
        }
      },
      '10': {
        start: {
          line: 59,
          column: 6
        },
        end: {
          line: 59,
          column: 42
        }
      },
      '11': {
        start: {
          line: 61,
          column: 4
        },
        end: {
          line: 61,
          column: 77
        }
      },
      '12': {
        start: {
          line: 64,
          column: 2
        },
        end: {
          line: 66,
          column: 5
        }
      },
      '13': {
        start: {
          line: 65,
          column: 4
        },
        end: {
          line: 65,
          column: 25
        }
      },
      '14': {
        start: {
          line: 68,
          column: 2
        },
        end: {
          line: 125,
          column: 5
        }
      },
      '15': {
        start: {
          line: 69,
          column: 4
        },
        end: {
          line: 124,
          column: 7
        }
      },
      '16': {
        start: {
          line: 70,
          column: 21
        },
        end: {
          line: 70,
          column: 48
        }
      },
      '17': {
        start: {
          line: 71,
          column: 6
        },
        end: {
          line: 71,
          column: 32
        }
      },
      '18': {
        start: {
          line: 73,
          column: 6
        },
        end: {
          line: 73,
          column: 30
        }
      },
      '19': {
        start: {
          line: 75,
          column: 6
        },
        end: {
          line: 75,
          column: 73
        }
      },
      '20': {
        start: {
          line: 77,
          column: 27
        },
        end: {
          line: 77,
          column: 56
        }
      },
      '21': {
        start: {
          line: 78,
          column: 6
        },
        end: {
          line: 78,
          column: 45
        }
      },
      '22': {
        start: {
          line: 79,
          column: 6
        },
        end: {
          line: 79,
          column: 76
        }
      },
      '23': {
        start: {
          line: 82,
          column: 6
        },
        end: {
          line: 82,
          column: 23
        }
      },
      '24': {
        start: {
          line: 84,
          column: 25
        },
        end: {
          line: 84,
          column: 63
        }
      },
      '25': {
        start: {
          line: 85,
          column: 6
        },
        end: {
          line: 85,
          column: 43
        }
      },
      '26': {
        start: {
          line: 86,
          column: 6
        },
        end: {
          line: 88,
          column: 8
        }
      },
      '27': {
        start: {
          line: 91,
          column: 6
        },
        end: {
          line: 91,
          column: 45
        }
      },
      '28': {
        start: {
          line: 93,
          column: 6
        },
        end: {
          line: 93,
          column: 43
        }
      },
      '29': {
        start: {
          line: 94,
          column: 6
        },
        end: {
          line: 96,
          column: 8
        }
      },
      '30': {
        start: {
          line: 99,
          column: 6
        },
        end: {
          line: 99,
          column: 30
        }
      },
      '31': {
        start: {
          line: 100,
          column: 6
        },
        end: {
          line: 100,
          column: 45
        }
      },
      '32': {
        start: {
          line: 101,
          column: 6
        },
        end: {
          line: 101,
          column: 76
        }
      },
      '33': {
        start: {
          line: 104,
          column: 6
        },
        end: {
          line: 104,
          column: 23
        }
      },
      '34': {
        start: {
          line: 105,
          column: 6
        },
        end: {
          line: 105,
          column: 43
        }
      },
      '35': {
        start: {
          line: 108,
          column: 6
        },
        end: {
          line: 108,
          column: 52
        }
      },
      '36': {
        start: {
          line: 109,
          column: 6
        },
        end: {
          line: 109,
          column: 45
        }
      },
      '37': {
        start: {
          line: 112,
          column: 6
        },
        end: {
          line: 112,
          column: 43
        }
      },
      '38': {
        start: {
          line: 115,
          column: 6
        },
        end: {
          line: 115,
          column: 30
        }
      },
      '39': {
        start: {
          line: 116,
          column: 6
        },
        end: {
          line: 116,
          column: 45
        }
      },
      '40': {
        start: {
          line: 118,
          column: 6
        },
        end: {
          line: 118,
          column: 23
        }
      },
      '41': {
        start: {
          line: 119,
          column: 6
        },
        end: {
          line: 119,
          column: 43
        }
      },
      '42': {
        start: {
          line: 121,
          column: 6
        },
        end: {
          line: 121,
          column: 45
        }
      },
      '43': {
        start: {
          line: 122,
          column: 6
        },
        end: {
          line: 122,
          column: 30
        }
      },
      '44': {
        start: {
          line: 123,
          column: 6
        },
        end: {
          line: 123,
          column: 45
        }
      },
      '45': {
        start: {
          line: 127,
          column: 2
        },
        end: {
          line: 154,
          column: 5
        }
      },
      '46': {
        start: {
          line: 128,
          column: 4
        },
        end: {
          line: 153,
          column: 7
        }
      },
      '47': {
        start: {
          line: 129,
          column: 21
        },
        end: {
          line: 129,
          column: 48
        }
      },
      '48': {
        start: {
          line: 131,
          column: 6
        },
        end: {
          line: 131,
          column: 30
        }
      },
      '49': {
        start: {
          line: 133,
          column: 6
        },
        end: {
          line: 133,
          column: 29
        }
      },
      '50': {
        start: {
          line: 134,
          column: 6
        },
        end: {
          line: 134,
          column: 28
        }
      },
      '51': {
        start: {
          line: 135,
          column: 27
        },
        end: {
          line: 135,
          column: 56
        }
      },
      '52': {
        start: {
          line: 136,
          column: 6
        },
        end: {
          line: 136,
          column: 45
        }
      },
      '53': {
        start: {
          line: 138,
          column: 6
        },
        end: {
          line: 138,
          column: 29
        }
      },
      '54': {
        start: {
          line: 139,
          column: 6
        },
        end: {
          line: 139,
          column: 28
        }
      },
      '55': {
        start: {
          line: 140,
          column: 6
        },
        end: {
          line: 140,
          column: 45
        }
      },
      '56': {
        start: {
          line: 141,
          column: 6
        },
        end: {
          line: 141,
          column: 76
        }
      },
      '57': {
        start: {
          line: 145,
          column: 21
        },
        end: {
          line: 145,
          column: 49
        }
      },
      '58': {
        start: {
          line: 147,
          column: 6
        },
        end: {
          line: 147,
          column: 60
        }
      },
      '59': {
        start: {
          line: 148,
          column: 6
        },
        end: {
          line: 148,
          column: 48
        }
      },
      '60': {
        start: {
          line: 150,
          column: 6
        },
        end: {
          line: 150,
          column: 29
        }
      },
      '61': {
        start: {
          line: 151,
          column: 6
        },
        end: {
          line: 151,
          column: 30
        }
      },
      '62': {
        start: {
          line: 152,
          column: 6
        },
        end: {
          line: 152,
          column: 45
        }
      },
      '63': {
        start: {
          line: 156,
          column: 2
        },
        end: {
          line: 174,
          column: 5
        }
      },
      '64': {
        start: {
          line: 157,
          column: 4
        },
        end: {
          line: 173,
          column: 7
        }
      },
      '65': {
        start: {
          line: 158,
          column: 21
        },
        end: {
          line: 158,
          column: 48
        }
      },
      '66': {
        start: {
          line: 160,
          column: 6
        },
        end: {
          line: 160,
          column: 30
        }
      },
      '67': {
        start: {
          line: 162,
          column: 6
        },
        end: {
          line: 162,
          column: 32
        }
      },
      '68': {
        start: {
          line: 163,
          column: 6
        },
        end: {
          line: 163,
          column: 28
        }
      },
      '69': {
        start: {
          line: 164,
          column: 27
        },
        end: {
          line: 164,
          column: 56
        }
      },
      '70': {
        start: {
          line: 165,
          column: 6
        },
        end: {
          line: 165,
          column: 45
        }
      },
      '71': {
        start: {
          line: 167,
          column: 6
        },
        end: {
          line: 167,
          column: 63
        }
      },
      '72': {
        start: {
          line: 168,
          column: 6
        },
        end: {
          line: 168,
          column: 29
        }
      },
      '73': {
        start: {
          line: 169,
          column: 6
        },
        end: {
          line: 169,
          column: 47
        }
      },
      '74': {
        start: {
          line: 170,
          column: 6
        },
        end: {
          line: 170,
          column: 28
        }
      },
      '75': {
        start: {
          line: 171,
          column: 6
        },
        end: {
          line: 171,
          column: 45
        }
      },
      '76': {
        start: {
          line: 172,
          column: 6
        },
        end: {
          line: 172,
          column: 76
        }
      }
    },
    fnMap: {
      '0': {
        name: '(anonymous_0)',
        decl: {
          start: {
            line: 21,
            column: 33
          },
          end: {
            line: 21,
            column: 34
          }
        },
        loc: {
          start: {
            line: 21,
            column: 39
          },
          end: {
            line: 175,
            column: 1
          }
        },
        line: 21
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 26,
            column: 13
          },
          end: {
            line: 26,
            column: 14
          }
        },
        loc: {
          start: {
            line: 26,
            column: 19
          },
          end: {
            line: 62,
            column: 3
          }
        },
        line: 26
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 58,
            column: 64
          },
          end: {
            line: 58,
            column: 65
          }
        },
        loc: {
          start: {
            line: 58,
            column: 76
          },
          end: {
            line: 60,
            column: 5
          }
        },
        line: 58
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 64,
            column: 12
          },
          end: {
            line: 64,
            column: 13
          }
        },
        loc: {
          start: {
            line: 64,
            column: 18
          },
          end: {
            line: 66,
            column: 3
          }
        },
        line: 64
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 68,
            column: 36
          },
          end: {
            line: 68,
            column: 37
          }
        },
        loc: {
          start: {
            line: 68,
            column: 42
          },
          end: {
            line: 125,
            column: 3
          }
        },
        line: 68
      },
      '5': {
        name: '(anonymous_5)',
        decl: {
          start: {
            line: 69,
            column: 20
          },
          end: {
            line: 69,
            column: 21
          }
        },
        loc: {
          start: {
            line: 69,
            column: 32
          },
          end: {
            line: 124,
            column: 5
          }
        },
        line: 69
      },
      '6': {
        name: '(anonymous_6)',
        decl: {
          start: {
            line: 127,
            column: 46
          },
          end: {
            line: 127,
            column: 47
          }
        },
        loc: {
          start: {
            line: 127,
            column: 52
          },
          end: {
            line: 154,
            column: 3
          }
        },
        line: 127
      },
      '7': {
        name: '(anonymous_7)',
        decl: {
          start: {
            line: 128,
            column: 20
          },
          end: {
            line: 128,
            column: 21
          }
        },
        loc: {
          start: {
            line: 128,
            column: 32
          },
          end: {
            line: 153,
            column: 5
          }
        },
        line: 128
      },
      '8': {
        name: '(anonymous_8)',
        decl: {
          start: {
            line: 156,
            column: 44
          },
          end: {
            line: 156,
            column: 45
          }
        },
        loc: {
          start: {
            line: 156,
            column: 50
          },
          end: {
            line: 174,
            column: 3
          }
        },
        line: 156
      },
      '9': {
        name: '(anonymous_9)',
        decl: {
          start: {
            line: 157,
            column: 20
          },
          end: {
            line: 157,
            column: 21
          }
        },
        loc: {
          start: {
            line: 157,
            column: 32
          },
          end: {
            line: 173,
            column: 5
          }
        },
        line: 157
      }
    },
    branchMap: {},
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0,
      '33': 0,
      '34': 0,
      '35': 0,
      '36': 0,
      '37': 0,
      '38': 0,
      '39': 0,
      '40': 0,
      '41': 0,
      '42': 0,
      '43': 0,
      '44': 0,
      '45': 0,
      '46': 0,
      '47': 0,
      '48': 0,
      '49': 0,
      '50': 0,
      '51': 0,
      '52': 0,
      '53': 0,
      '54': 0,
      '55': 0,
      '56': 0,
      '57': 0,
      '58': 0,
      '59': 0,
      '60': 0,
      '61': 0,
      '62': 0,
      '63': 0,
      '64': 0,
      '65': 0,
      '66': 0,
      '67': 0,
      '68': 0,
      '69': 0,
      '70': 0,
      '71': 0,
      '72': 0,
      '73': 0,
      '74': 0,
      '75': 0,
      '76': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0
    },
    b: {},
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

var _asyncToGenerator = _interopRequireDefault(require('async-to-generator'));

var _atom = require('atom');

var _testHelpers;

function _load_testHelpers() {
  return _testHelpers = require('nuclide-commons-atom/test-helpers');
}

var _promise;

function _load_promise() {
  return _promise = require('nuclide-commons/promise');
}

var _UniversalDisposable;

function _load_UniversalDisposable() {
  return _UniversalDisposable = _interopRequireDefault(require('nuclide-commons/UniversalDisposable'));
}

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */

cov_1qr5v5ar19.s[0]++;


describe('SignatureHelpManager', () => {
  cov_1qr5v5ar19.f[0]++;

  let disposable;
  let testProvider;
  let mockDatatipService;

  cov_1qr5v5ar19.s[1]++;
  beforeEach(() => {
    cov_1qr5v5ar19.f[1]++;
    cov_1qr5v5ar19.s[2]++;

    (0, (_testHelpers || _load_testHelpers()).jasmineAttachWorkspace)();
    cov_1qr5v5ar19.s[3]++;
    jasmine.Clock.useMock();
    cov_1qr5v5ar19.s[4]++;
    atom.packages.activatePackage('atom-ide-signature-help');

    cov_1qr5v5ar19.s[5]++;
    testProvider = {
      priority: 1,
      grammarScopes: ['text.plain.null-grammar'],
      triggerCharacters: new Set(['(']),
      getSignatureHelp: jasmine.createSpy().andReturn(Promise.resolve({
        signatures: [{
          label: 'test signature'
        }]
      }))
    };
    cov_1qr5v5ar19.s[6]++;
    mockDatatipService = {
      addProvider() {
        cov_1qr5v5ar19.s[7]++;

        throw Error();
      },
      addModifierProvider() {
        cov_1qr5v5ar19.s[8]++;

        throw Error();
      },
      createPinnedDataTip: jasmine.createSpy().andReturn(new (_UniversalDisposable || _load_UniversalDisposable()).default())
    };
    cov_1qr5v5ar19.s[9]++;
    atom.packages.serviceHub.consume('signature-help', '0.1.0', registry => {
      cov_1qr5v5ar19.f[2]++;
      cov_1qr5v5ar19.s[10]++;

      disposable = registry(testProvider);
    });
    cov_1qr5v5ar19.s[11]++;
    atom.packages.serviceHub.provide('datatip', '0.1.0', mockDatatipService);
  });

  cov_1qr5v5ar19.s[12]++;
  afterEach(() => {
    cov_1qr5v5ar19.f[3]++;
    cov_1qr5v5ar19.s[13]++;

    disposable.dispose();
  });

  cov_1qr5v5ar19.s[14]++;
  it('responds to manual triggers', () => {
    cov_1qr5v5ar19.f[4]++;
    cov_1qr5v5ar19.s[15]++;

    waitsForPromise((0, _asyncToGenerator.default)(function* () {
      cov_1qr5v5ar19.f[5]++;

      const editor = (cov_1qr5v5ar19.s[16]++, yield atom.workspace.open());
      cov_1qr5v5ar19.s[17]++;
      editor.insertText('test');
      // Active editor debounce.
      cov_1qr5v5ar19.s[18]++;
      jasmine.Clock.tick(500);

      cov_1qr5v5ar19.s[19]++;
      atom.commands.dispatch(editor.getElement(), 'signature-help:show');

      const signatureSpy = (cov_1qr5v5ar19.s[20]++, testProvider.getSignatureHelp);
      cov_1qr5v5ar19.s[21]++;
      expect(signatureSpy.callCount).toBe(1);
      cov_1qr5v5ar19.s[22]++;
      expect(signatureSpy.calls[0].args).toEqual([editor, new _atom.Point(0, 4)]);

      // Wait for promise to be resolved.
      cov_1qr5v5ar19.s[23]++;
      yield (0, (_promise || _load_promise()).nextTick)();

      const datatipSpy = (cov_1qr5v5ar19.s[24]++, mockDatatipService.createPinnedDataTip);
      cov_1qr5v5ar19.s[25]++;
      expect(datatipSpy.callCount).toBe(1);
      cov_1qr5v5ar19.s[26]++;
      expect(datatipSpy.calls[0].args[0].range).toEqual(new _atom.Range([0, 4], [0, 4]));

      // Moving the cursor should immediately move the datatip and query again.
      cov_1qr5v5ar19.s[27]++;
      editor.setCursorBufferPosition([0, 3]);

      cov_1qr5v5ar19.s[28]++;
      expect(datatipSpy.callCount).toBe(2);
      cov_1qr5v5ar19.s[29]++;
      expect(datatipSpy.calls[1].args[0].range).toEqual(new _atom.Range([0, 3], [0, 3]));

      // Compensate for the debounce.
      cov_1qr5v5ar19.s[30]++;
      jasmine.Clock.tick(500);
      cov_1qr5v5ar19.s[31]++;
      expect(signatureSpy.callCount).toBe(2);
      cov_1qr5v5ar19.s[32]++;
      expect(signatureSpy.calls[1].args).toEqual([editor, new _atom.Point(0, 3)]);

      // Wait for promise to be resolved.
      cov_1qr5v5ar19.s[33]++;
      yield (0, (_promise || _load_promise()).nextTick)();
      cov_1qr5v5ar19.s[34]++;
      expect(datatipSpy.callCount).toBe(3);

      // Once the signature returns null, abort the flow.
      cov_1qr5v5ar19.s[35]++;
      signatureSpy.andReturn(Promise.resolve(null));
      cov_1qr5v5ar19.s[36]++;
      editor.setCursorBufferPosition([0, 0]);

      // No repositioning when the cursor moves too far.
      cov_1qr5v5ar19.s[37]++;
      expect(datatipSpy.callCount).toBe(3);

      // Compensate for the debounce.
      cov_1qr5v5ar19.s[38]++;
      jasmine.Clock.tick(500);
      cov_1qr5v5ar19.s[39]++;
      expect(signatureSpy.callCount).toBe(3);

      cov_1qr5v5ar19.s[40]++;
      yield (0, (_promise || _load_promise()).nextTick)();
      cov_1qr5v5ar19.s[41]++;
      expect(datatipSpy.callCount).toBe(3);

      cov_1qr5v5ar19.s[42]++;
      editor.setCursorBufferPosition([0, 1]);
      cov_1qr5v5ar19.s[43]++;
      jasmine.Clock.tick(500);
      cov_1qr5v5ar19.s[44]++;
      expect(signatureSpy.callCount).toBe(3);
    }));
  });

  cov_1qr5v5ar19.s[45]++;
  it('responds to typing trigger characters', () => {
    cov_1qr5v5ar19.f[6]++;
    cov_1qr5v5ar19.s[46]++;

    waitsForPromise((0, _asyncToGenerator.default)(function* () {
      cov_1qr5v5ar19.f[7]++;

      const editor = (cov_1qr5v5ar19.s[47]++, yield atom.workspace.open());
      // Active editor debounce.
      cov_1qr5v5ar19.s[48]++;
      jasmine.Clock.tick(500);

      cov_1qr5v5ar19.s[49]++;
      editor.insertText('a');
      cov_1qr5v5ar19.s[50]++;
      jasmine.Clock.tick(1); // debounce
      const signatureSpy = (cov_1qr5v5ar19.s[51]++, testProvider.getSignatureHelp);
      cov_1qr5v5ar19.s[52]++;
      expect(signatureSpy.callCount).toBe(0);

      cov_1qr5v5ar19.s[53]++;
      editor.insertText('(');
      cov_1qr5v5ar19.s[54]++;
      jasmine.Clock.tick(1); // debounce
      cov_1qr5v5ar19.s[55]++;
      expect(signatureSpy.callCount).toBe(1);
      cov_1qr5v5ar19.s[56]++;
      expect(signatureSpy.calls[0].args).toEqual([editor, new _atom.Point(0, 2)]);

      // We've tested the regular flow above; test cancellation too.
      /* global KeyboardEvent */
      const escape = (cov_1qr5v5ar19.s[57]++, new KeyboardEvent('keydown'));
      // No APi to set keyCode :(
      cov_1qr5v5ar19.s[58]++;
      Object.defineProperty(escape, 'keyCode', { value: 27 });
      cov_1qr5v5ar19.s[59]++;
      editor.getElement().dispatchEvent(escape);

      cov_1qr5v5ar19.s[60]++;
      editor.insertText('x');
      cov_1qr5v5ar19.s[61]++;
      jasmine.Clock.tick(500); // debounce
      cov_1qr5v5ar19.s[62]++;
      expect(signatureSpy.callCount).toBe(1);
    }));
  });

  cov_1qr5v5ar19.s[63]++;
  it('responds to typing over a selection', () => {
    cov_1qr5v5ar19.f[8]++;
    cov_1qr5v5ar19.s[64]++;

    waitsForPromise((0, _asyncToGenerator.default)(function* () {
      cov_1qr5v5ar19.f[9]++;

      const editor = (cov_1qr5v5ar19.s[65]++, yield atom.workspace.open());
      // Active editor debounce.
      cov_1qr5v5ar19.s[66]++;
      jasmine.Clock.tick(500);

      cov_1qr5v5ar19.s[67]++;
      editor.setText('(abcdef');
      cov_1qr5v5ar19.s[68]++;
      jasmine.Clock.tick(1); // debounce
      const signatureSpy = (cov_1qr5v5ar19.s[69]++, testProvider.getSignatureHelp);
      cov_1qr5v5ar19.s[70]++;
      expect(signatureSpy.callCount).toBe(0);

      cov_1qr5v5ar19.s[71]++;
      editor.setSelectedBufferRange(new _atom.Range([0, 0], [0, 1]));
      cov_1qr5v5ar19.s[72]++;
      editor.insertText('(');
      cov_1qr5v5ar19.s[73]++;
      expect(editor.getText()).toBe('(abcdef');
      cov_1qr5v5ar19.s[74]++;
      jasmine.Clock.tick(1); // debounce
      cov_1qr5v5ar19.s[75]++;
      expect(signatureSpy.callCount).toBe(1);
      cov_1qr5v5ar19.s[76]++;
      expect(signatureSpy.calls[0].args).toEqual([editor, new _atom.Point(0, 1)]);
    }));
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNpZ25hdHVyZUhlbHBNYW5hZ2VyLXNwZWMuanMiXSwibmFtZXMiOlsiZGVzY3JpYmUiLCJkaXNwb3NhYmxlIiwidGVzdFByb3ZpZGVyIiwibW9ja0RhdGF0aXBTZXJ2aWNlIiwiYmVmb3JlRWFjaCIsImphc21pbmUiLCJDbG9jayIsInVzZU1vY2siLCJhdG9tIiwicGFja2FnZXMiLCJhY3RpdmF0ZVBhY2thZ2UiLCJwcmlvcml0eSIsImdyYW1tYXJTY29wZXMiLCJ0cmlnZ2VyQ2hhcmFjdGVycyIsIlNldCIsImdldFNpZ25hdHVyZUhlbHAiLCJjcmVhdGVTcHkiLCJhbmRSZXR1cm4iLCJQcm9taXNlIiwicmVzb2x2ZSIsInNpZ25hdHVyZXMiLCJsYWJlbCIsImFkZFByb3ZpZGVyIiwiRXJyb3IiLCJhZGRNb2RpZmllclByb3ZpZGVyIiwiY3JlYXRlUGlubmVkRGF0YVRpcCIsInNlcnZpY2VIdWIiLCJjb25zdW1lIiwicmVnaXN0cnkiLCJwcm92aWRlIiwiYWZ0ZXJFYWNoIiwiZGlzcG9zZSIsIml0Iiwid2FpdHNGb3JQcm9taXNlIiwiZWRpdG9yIiwid29ya3NwYWNlIiwib3BlbiIsImluc2VydFRleHQiLCJ0aWNrIiwiY29tbWFuZHMiLCJkaXNwYXRjaCIsImdldEVsZW1lbnQiLCJzaWduYXR1cmVTcHkiLCJleHBlY3QiLCJjYWxsQ291bnQiLCJ0b0JlIiwiY2FsbHMiLCJhcmdzIiwidG9FcXVhbCIsImRhdGF0aXBTcHkiLCJyYW5nZSIsInNldEN1cnNvckJ1ZmZlclBvc2l0aW9uIiwiZXNjYXBlIiwiS2V5Ym9hcmRFdmVudCIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwidmFsdWUiLCJkaXNwYXRjaEV2ZW50Iiwic2V0VGV4dCIsInNldFNlbGVjdGVkQnVmZmVyUmFuZ2UiLCJnZXRUZXh0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWVBOzs7O0FBQ0E7QUFBQTtBQUFBOzs7O0FBQ0E7QUFBQTtBQUFBOzs7O0FBQ0E7QUFBQTtBQUFBOzs7O0FBbEJBOzs7Ozs7Ozs7Ozs7Ozs7QUFvQkFBLFNBQVMsc0JBQVQsRUFBaUMsTUFBTTtBQUFBOztBQUNyQyxNQUFJQyxVQUFKO0FBQ0EsTUFBSUMsWUFBSjtBQUNBLE1BQUlDLGtCQUFKOztBQUhxQztBQUtyQ0MsYUFBVyxNQUFNO0FBQUE7QUFBQTs7QUFDZjtBQURlO0FBRWZDLFlBQVFDLEtBQVIsQ0FBY0MsT0FBZDtBQUZlO0FBR2ZDLFNBQUtDLFFBQUwsQ0FBY0MsZUFBZCxDQUE4Qix5QkFBOUI7O0FBSGU7QUFLZlIsbUJBQWU7QUFDYlMsZ0JBQVUsQ0FERztBQUViQyxxQkFBZSxDQUFDLHlCQUFELENBRkY7QUFHYkMseUJBQW1CLElBQUlDLEdBQUosQ0FBUSxDQUFDLEdBQUQsQ0FBUixDQUhOO0FBSWJDLHdCQUFrQlYsUUFBUVcsU0FBUixHQUFvQkMsU0FBcEIsQ0FDaEJDLFFBQVFDLE9BQVIsQ0FDRztBQUNDQyxvQkFBWSxDQUNWO0FBQ0VDLGlCQUFPO0FBRFQsU0FEVTtBQURiLE9BREgsQ0FEZ0I7QUFKTCxLQUFmO0FBTGU7QUFxQmZsQix5QkFBcUI7QUFDbkJtQixvQkFBYztBQUFBOztBQUNaLGNBQU1DLE9BQU47QUFDRCxPQUhrQjtBQUluQkMsNEJBQXNCO0FBQUE7O0FBQ3BCLGNBQU1ELE9BQU47QUFDRCxPQU5rQjtBQU9uQkUsMkJBQXFCcEIsUUFDbEJXLFNBRGtCLEdBRWxCQyxTQUZrQixDQUVSLG1FQUZRO0FBUEYsS0FBckI7QUFyQmU7QUFnQ2ZULFNBQUtDLFFBQUwsQ0FBY2lCLFVBQWQsQ0FBeUJDLE9BQXpCLENBQWlDLGdCQUFqQyxFQUFtRCxPQUFuRCxFQUE0REMsWUFBWTtBQUFBO0FBQUE7O0FBQ3RFM0IsbUJBQWEyQixTQUFTMUIsWUFBVCxDQUFiO0FBQ0QsS0FGRDtBQWhDZTtBQW1DZk0sU0FBS0MsUUFBTCxDQUFjaUIsVUFBZCxDQUF5QkcsT0FBekIsQ0FBaUMsU0FBakMsRUFBNEMsT0FBNUMsRUFBcUQxQixrQkFBckQ7QUFDRCxHQXBDRDs7QUFMcUM7QUEyQ3JDMkIsWUFBVSxNQUFNO0FBQUE7QUFBQTs7QUFDZDdCLGVBQVc4QixPQUFYO0FBQ0QsR0FGRDs7QUEzQ3FDO0FBK0NyQ0MsS0FBRyw2QkFBSCxFQUFrQyxNQUFNO0FBQUE7QUFBQTs7QUFDdENDLG1EQUFnQixhQUFZO0FBQUE7O0FBQzFCLFlBQU1DLGtDQUFTLE1BQU0xQixLQUFLMkIsU0FBTCxDQUFlQyxJQUFmLEVBQWYsQ0FBTjtBQUQwQjtBQUUxQkYsYUFBT0csVUFBUCxDQUFrQixNQUFsQjtBQUNBO0FBSDBCO0FBSTFCaEMsY0FBUUMsS0FBUixDQUFjZ0MsSUFBZCxDQUFtQixHQUFuQjs7QUFKMEI7QUFNMUI5QixXQUFLK0IsUUFBTCxDQUFjQyxRQUFkLENBQXVCTixPQUFPTyxVQUFQLEVBQXZCLEVBQTRDLHFCQUE1Qzs7QUFFQSxZQUFNQyx3Q0FBZXhDLGFBQWFhLGdCQUE1QixDQUFOO0FBUjBCO0FBUzFCNEIsYUFBT0QsYUFBYUUsU0FBcEIsRUFBK0JDLElBQS9CLENBQW9DLENBQXBDO0FBVDBCO0FBVTFCRixhQUFPRCxhQUFhSSxLQUFiLENBQW1CLENBQW5CLEVBQXNCQyxJQUE3QixFQUFtQ0MsT0FBbkMsQ0FBMkMsQ0FBQ2QsTUFBRCxFQUFTLGdCQUFVLENBQVYsRUFBYSxDQUFiLENBQVQsQ0FBM0M7O0FBRUE7QUFaMEI7QUFhMUIsWUFBTSw2Q0FBTjs7QUFFQSxZQUFNZSxzQ0FBYTlDLG1CQUFtQnNCLG1CQUFoQyxDQUFOO0FBZjBCO0FBZ0IxQmtCLGFBQU9NLFdBQVdMLFNBQWxCLEVBQTZCQyxJQUE3QixDQUFrQyxDQUFsQztBQWhCMEI7QUFpQjFCRixhQUFPTSxXQUFXSCxLQUFYLENBQWlCLENBQWpCLEVBQW9CQyxJQUFwQixDQUF5QixDQUF6QixFQUE0QkcsS0FBbkMsRUFBMENGLE9BQTFDLENBQ0UsZ0JBQVUsQ0FBQyxDQUFELEVBQUksQ0FBSixDQUFWLEVBQWtCLENBQUMsQ0FBRCxFQUFJLENBQUosQ0FBbEIsQ0FERjs7QUFJQTtBQXJCMEI7QUFzQjFCZCxhQUFPaUIsdUJBQVAsQ0FBK0IsQ0FBQyxDQUFELEVBQUksQ0FBSixDQUEvQjs7QUF0QjBCO0FBd0IxQlIsYUFBT00sV0FBV0wsU0FBbEIsRUFBNkJDLElBQTdCLENBQWtDLENBQWxDO0FBeEIwQjtBQXlCMUJGLGFBQU9NLFdBQVdILEtBQVgsQ0FBaUIsQ0FBakIsRUFBb0JDLElBQXBCLENBQXlCLENBQXpCLEVBQTRCRyxLQUFuQyxFQUEwQ0YsT0FBMUMsQ0FDRSxnQkFBVSxDQUFDLENBQUQsRUFBSSxDQUFKLENBQVYsRUFBa0IsQ0FBQyxDQUFELEVBQUksQ0FBSixDQUFsQixDQURGOztBQUlBO0FBN0IwQjtBQThCMUIzQyxjQUFRQyxLQUFSLENBQWNnQyxJQUFkLENBQW1CLEdBQW5CO0FBOUIwQjtBQStCMUJLLGFBQU9ELGFBQWFFLFNBQXBCLEVBQStCQyxJQUEvQixDQUFvQyxDQUFwQztBQS9CMEI7QUFnQzFCRixhQUFPRCxhQUFhSSxLQUFiLENBQW1CLENBQW5CLEVBQXNCQyxJQUE3QixFQUFtQ0MsT0FBbkMsQ0FBMkMsQ0FBQ2QsTUFBRCxFQUFTLGdCQUFVLENBQVYsRUFBYSxDQUFiLENBQVQsQ0FBM0M7O0FBRUE7QUFsQzBCO0FBbUMxQixZQUFNLDZDQUFOO0FBbkMwQjtBQW9DMUJTLGFBQU9NLFdBQVdMLFNBQWxCLEVBQTZCQyxJQUE3QixDQUFrQyxDQUFsQzs7QUFFQTtBQXRDMEI7QUF1QzFCSCxtQkFBYXpCLFNBQWIsQ0FBdUJDLFFBQVFDLE9BQVIsQ0FBZ0IsSUFBaEIsQ0FBdkI7QUF2QzBCO0FBd0MxQmUsYUFBT2lCLHVCQUFQLENBQStCLENBQUMsQ0FBRCxFQUFJLENBQUosQ0FBL0I7O0FBRUE7QUExQzBCO0FBMkMxQlIsYUFBT00sV0FBV0wsU0FBbEIsRUFBNkJDLElBQTdCLENBQWtDLENBQWxDOztBQUVBO0FBN0MwQjtBQThDMUJ4QyxjQUFRQyxLQUFSLENBQWNnQyxJQUFkLENBQW1CLEdBQW5CO0FBOUMwQjtBQStDMUJLLGFBQU9ELGFBQWFFLFNBQXBCLEVBQStCQyxJQUEvQixDQUFvQyxDQUFwQzs7QUEvQzBCO0FBaUQxQixZQUFNLDZDQUFOO0FBakQwQjtBQWtEMUJGLGFBQU9NLFdBQVdMLFNBQWxCLEVBQTZCQyxJQUE3QixDQUFrQyxDQUFsQzs7QUFsRDBCO0FBb0QxQlgsYUFBT2lCLHVCQUFQLENBQStCLENBQUMsQ0FBRCxFQUFJLENBQUosQ0FBL0I7QUFwRDBCO0FBcUQxQjlDLGNBQVFDLEtBQVIsQ0FBY2dDLElBQWQsQ0FBbUIsR0FBbkI7QUFyRDBCO0FBc0QxQkssYUFBT0QsYUFBYUUsU0FBcEIsRUFBK0JDLElBQS9CLENBQW9DLENBQXBDO0FBQ0QsS0F2REQ7QUF3REQsR0F6REQ7O0FBL0NxQztBQTBHckNiLEtBQUcsdUNBQUgsRUFBNEMsTUFBTTtBQUFBO0FBQUE7O0FBQ2hEQyxtREFBZ0IsYUFBWTtBQUFBOztBQUMxQixZQUFNQyxrQ0FBUyxNQUFNMUIsS0FBSzJCLFNBQUwsQ0FBZUMsSUFBZixFQUFmLENBQU47QUFDQTtBQUYwQjtBQUcxQi9CLGNBQVFDLEtBQVIsQ0FBY2dDLElBQWQsQ0FBbUIsR0FBbkI7O0FBSDBCO0FBSzFCSixhQUFPRyxVQUFQLENBQWtCLEdBQWxCO0FBTDBCO0FBTTFCaEMsY0FBUUMsS0FBUixDQUFjZ0MsSUFBZCxDQUFtQixDQUFuQixFQU4wQixDQU1IO0FBQ3ZCLFlBQU1JLHdDQUFleEMsYUFBYWEsZ0JBQTVCLENBQU47QUFQMEI7QUFRMUI0QixhQUFPRCxhQUFhRSxTQUFwQixFQUErQkMsSUFBL0IsQ0FBb0MsQ0FBcEM7O0FBUjBCO0FBVTFCWCxhQUFPRyxVQUFQLENBQWtCLEdBQWxCO0FBVjBCO0FBVzFCaEMsY0FBUUMsS0FBUixDQUFjZ0MsSUFBZCxDQUFtQixDQUFuQixFQVgwQixDQVdIO0FBWEc7QUFZMUJLLGFBQU9ELGFBQWFFLFNBQXBCLEVBQStCQyxJQUEvQixDQUFvQyxDQUFwQztBQVowQjtBQWExQkYsYUFBT0QsYUFBYUksS0FBYixDQUFtQixDQUFuQixFQUFzQkMsSUFBN0IsRUFBbUNDLE9BQW5DLENBQTJDLENBQUNkLE1BQUQsRUFBUyxnQkFBVSxDQUFWLEVBQWEsQ0FBYixDQUFULENBQTNDOztBQUVBO0FBQ0E7QUFDQSxZQUFNa0Isa0NBQVMsSUFBSUMsYUFBSixDQUFrQixTQUFsQixDQUFULENBQU47QUFDQTtBQWxCMEI7QUFtQjFCQyxhQUFPQyxjQUFQLENBQXNCSCxNQUF0QixFQUE4QixTQUE5QixFQUF5QyxFQUFDSSxPQUFPLEVBQVIsRUFBekM7QUFuQjBCO0FBb0IxQnRCLGFBQU9PLFVBQVAsR0FBb0JnQixhQUFwQixDQUFrQ0wsTUFBbEM7O0FBcEIwQjtBQXNCMUJsQixhQUFPRyxVQUFQLENBQWtCLEdBQWxCO0FBdEIwQjtBQXVCMUJoQyxjQUFRQyxLQUFSLENBQWNnQyxJQUFkLENBQW1CLEdBQW5CLEVBdkIwQixDQXVCRDtBQXZCQztBQXdCMUJLLGFBQU9ELGFBQWFFLFNBQXBCLEVBQStCQyxJQUEvQixDQUFvQyxDQUFwQztBQUNELEtBekJEO0FBMEJELEdBM0JEOztBQTFHcUM7QUF1SXJDYixLQUFHLHFDQUFILEVBQTBDLE1BQU07QUFBQTtBQUFBOztBQUM5Q0MsbURBQWdCLGFBQVk7QUFBQTs7QUFDMUIsWUFBTUMsa0NBQVMsTUFBTTFCLEtBQUsyQixTQUFMLENBQWVDLElBQWYsRUFBZixDQUFOO0FBQ0E7QUFGMEI7QUFHMUIvQixjQUFRQyxLQUFSLENBQWNnQyxJQUFkLENBQW1CLEdBQW5COztBQUgwQjtBQUsxQkosYUFBT3dCLE9BQVAsQ0FBZSxTQUFmO0FBTDBCO0FBTTFCckQsY0FBUUMsS0FBUixDQUFjZ0MsSUFBZCxDQUFtQixDQUFuQixFQU4wQixDQU1IO0FBQ3ZCLFlBQU1JLHdDQUFleEMsYUFBYWEsZ0JBQTVCLENBQU47QUFQMEI7QUFRMUI0QixhQUFPRCxhQUFhRSxTQUFwQixFQUErQkMsSUFBL0IsQ0FBb0MsQ0FBcEM7O0FBUjBCO0FBVTFCWCxhQUFPeUIsc0JBQVAsQ0FBOEIsZ0JBQVUsQ0FBQyxDQUFELEVBQUksQ0FBSixDQUFWLEVBQWtCLENBQUMsQ0FBRCxFQUFJLENBQUosQ0FBbEIsQ0FBOUI7QUFWMEI7QUFXMUJ6QixhQUFPRyxVQUFQLENBQWtCLEdBQWxCO0FBWDBCO0FBWTFCTSxhQUFPVCxPQUFPMEIsT0FBUCxFQUFQLEVBQXlCZixJQUF6QixDQUE4QixTQUE5QjtBQVowQjtBQWExQnhDLGNBQVFDLEtBQVIsQ0FBY2dDLElBQWQsQ0FBbUIsQ0FBbkIsRUFiMEIsQ0FhSDtBQWJHO0FBYzFCSyxhQUFPRCxhQUFhRSxTQUFwQixFQUErQkMsSUFBL0IsQ0FBb0MsQ0FBcEM7QUFkMEI7QUFlMUJGLGFBQU9ELGFBQWFJLEtBQWIsQ0FBbUIsQ0FBbkIsRUFBc0JDLElBQTdCLEVBQW1DQyxPQUFuQyxDQUEyQyxDQUFDZCxNQUFELEVBQVMsZ0JBQVUsQ0FBVixFQUFhLENBQWIsQ0FBVCxDQUEzQztBQUNELEtBaEJEO0FBaUJELEdBbEJEO0FBbUJELENBMUpEIiwiZmlsZSI6IlNpZ25hdHVyZUhlbHBNYW5hZ2VyLXNwZWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4gQW4gYWRkaXRpb25hbCBncmFudFxuICogb2YgcGF0ZW50IHJpZ2h0cyBjYW4gYmUgZm91bmQgaW4gdGhlIFBBVEVOVFMgZmlsZSBpbiB0aGUgc2FtZSBkaXJlY3RvcnkuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuXG5pbXBvcnQgdHlwZSB7RGF0YXRpcFNlcnZpY2V9IGZyb20gJy4uLy4uL2F0b20taWRlLWRhdGF0aXAvbGliL3R5cGVzJztcbmltcG9ydCB0eXBlIHtTaWduYXR1cmVIZWxwLCBTaWduYXR1cmVIZWxwUHJvdmlkZXJ9IGZyb20gJy4uL2xpYi90eXBlcyc7XG5cbmltcG9ydCB7UG9pbnQsIFJhbmdlfSBmcm9tICdhdG9tJztcbmltcG9ydCB7amFzbWluZUF0dGFjaFdvcmtzcGFjZX0gZnJvbSAnbnVjbGlkZS1jb21tb25zLWF0b20vdGVzdC1oZWxwZXJzJztcbmltcG9ydCB7bmV4dFRpY2t9IGZyb20gJ251Y2xpZGUtY29tbW9ucy9wcm9taXNlJztcbmltcG9ydCBVbml2ZXJzYWxEaXNwb3NhYmxlIGZyb20gJ251Y2xpZGUtY29tbW9ucy9Vbml2ZXJzYWxEaXNwb3NhYmxlJztcblxuZGVzY3JpYmUoJ1NpZ25hdHVyZUhlbHBNYW5hZ2VyJywgKCkgPT4ge1xuICBsZXQgZGlzcG9zYWJsZTogSURpc3Bvc2FibGU7XG4gIGxldCB0ZXN0UHJvdmlkZXI6IFNpZ25hdHVyZUhlbHBQcm92aWRlcjtcbiAgbGV0IG1vY2tEYXRhdGlwU2VydmljZTogRGF0YXRpcFNlcnZpY2U7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamFzbWluZUF0dGFjaFdvcmtzcGFjZSgpO1xuICAgIGphc21pbmUuQ2xvY2sudXNlTW9jaygpO1xuICAgIGF0b20ucGFja2FnZXMuYWN0aXZhdGVQYWNrYWdlKCdhdG9tLWlkZS1zaWduYXR1cmUtaGVscCcpO1xuXG4gICAgdGVzdFByb3ZpZGVyID0ge1xuICAgICAgcHJpb3JpdHk6IDEsXG4gICAgICBncmFtbWFyU2NvcGVzOiBbJ3RleHQucGxhaW4ubnVsbC1ncmFtbWFyJ10sXG4gICAgICB0cmlnZ2VyQ2hhcmFjdGVyczogbmV3IFNldChbJygnXSksXG4gICAgICBnZXRTaWduYXR1cmVIZWxwOiBqYXNtaW5lLmNyZWF0ZVNweSgpLmFuZFJldHVybihcbiAgICAgICAgUHJvbWlzZS5yZXNvbHZlKFxuICAgICAgICAgICh7XG4gICAgICAgICAgICBzaWduYXR1cmVzOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBsYWJlbDogJ3Rlc3Qgc2lnbmF0dXJlJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgfTogU2lnbmF0dXJlSGVscCksXG4gICAgICAgICksXG4gICAgICApLFxuICAgIH07XG4gICAgbW9ja0RhdGF0aXBTZXJ2aWNlID0ge1xuICAgICAgYWRkUHJvdmlkZXIoKSB7XG4gICAgICAgIHRocm93IEVycm9yKCk7XG4gICAgICB9LFxuICAgICAgYWRkTW9kaWZpZXJQcm92aWRlcigpIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoKTtcbiAgICAgIH0sXG4gICAgICBjcmVhdGVQaW5uZWREYXRhVGlwOiBqYXNtaW5lXG4gICAgICAgIC5jcmVhdGVTcHkoKVxuICAgICAgICAuYW5kUmV0dXJuKG5ldyBVbml2ZXJzYWxEaXNwb3NhYmxlKCkpLFxuICAgIH07XG4gICAgYXRvbS5wYWNrYWdlcy5zZXJ2aWNlSHViLmNvbnN1bWUoJ3NpZ25hdHVyZS1oZWxwJywgJzAuMS4wJywgcmVnaXN0cnkgPT4ge1xuICAgICAgZGlzcG9zYWJsZSA9IHJlZ2lzdHJ5KHRlc3RQcm92aWRlcik7XG4gICAgfSk7XG4gICAgYXRvbS5wYWNrYWdlcy5zZXJ2aWNlSHViLnByb3ZpZGUoJ2RhdGF0aXAnLCAnMC4xLjAnLCBtb2NrRGF0YXRpcFNlcnZpY2UpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGRpc3Bvc2FibGUuZGlzcG9zZSgpO1xuICB9KTtcblxuICBpdCgncmVzcG9uZHMgdG8gbWFudWFsIHRyaWdnZXJzJywgKCkgPT4ge1xuICAgIHdhaXRzRm9yUHJvbWlzZShhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlZGl0b3IgPSBhd2FpdCBhdG9tLndvcmtzcGFjZS5vcGVuKCk7XG4gICAgICBlZGl0b3IuaW5zZXJ0VGV4dCgndGVzdCcpO1xuICAgICAgLy8gQWN0aXZlIGVkaXRvciBkZWJvdW5jZS5cbiAgICAgIGphc21pbmUuQ2xvY2sudGljayg1MDApO1xuXG4gICAgICBhdG9tLmNvbW1hbmRzLmRpc3BhdGNoKGVkaXRvci5nZXRFbGVtZW50KCksICdzaWduYXR1cmUtaGVscDpzaG93Jyk7XG5cbiAgICAgIGNvbnN0IHNpZ25hdHVyZVNweSA9IHRlc3RQcm92aWRlci5nZXRTaWduYXR1cmVIZWxwO1xuICAgICAgZXhwZWN0KHNpZ25hdHVyZVNweS5jYWxsQ291bnQpLnRvQmUoMSk7XG4gICAgICBleHBlY3Qoc2lnbmF0dXJlU3B5LmNhbGxzWzBdLmFyZ3MpLnRvRXF1YWwoW2VkaXRvciwgbmV3IFBvaW50KDAsIDQpXSk7XG5cbiAgICAgIC8vIFdhaXQgZm9yIHByb21pc2UgdG8gYmUgcmVzb2x2ZWQuXG4gICAgICBhd2FpdCBuZXh0VGljaygpO1xuXG4gICAgICBjb25zdCBkYXRhdGlwU3B5ID0gbW9ja0RhdGF0aXBTZXJ2aWNlLmNyZWF0ZVBpbm5lZERhdGFUaXA7XG4gICAgICBleHBlY3QoZGF0YXRpcFNweS5jYWxsQ291bnQpLnRvQmUoMSk7XG4gICAgICBleHBlY3QoZGF0YXRpcFNweS5jYWxsc1swXS5hcmdzWzBdLnJhbmdlKS50b0VxdWFsKFxuICAgICAgICBuZXcgUmFuZ2UoWzAsIDRdLCBbMCwgNF0pLFxuICAgICAgKTtcblxuICAgICAgLy8gTW92aW5nIHRoZSBjdXJzb3Igc2hvdWxkIGltbWVkaWF0ZWx5IG1vdmUgdGhlIGRhdGF0aXAgYW5kIHF1ZXJ5IGFnYWluLlxuICAgICAgZWRpdG9yLnNldEN1cnNvckJ1ZmZlclBvc2l0aW9uKFswLCAzXSk7XG5cbiAgICAgIGV4cGVjdChkYXRhdGlwU3B5LmNhbGxDb3VudCkudG9CZSgyKTtcbiAgICAgIGV4cGVjdChkYXRhdGlwU3B5LmNhbGxzWzFdLmFyZ3NbMF0ucmFuZ2UpLnRvRXF1YWwoXG4gICAgICAgIG5ldyBSYW5nZShbMCwgM10sIFswLCAzXSksXG4gICAgICApO1xuXG4gICAgICAvLyBDb21wZW5zYXRlIGZvciB0aGUgZGVib3VuY2UuXG4gICAgICBqYXNtaW5lLkNsb2NrLnRpY2soNTAwKTtcbiAgICAgIGV4cGVjdChzaWduYXR1cmVTcHkuY2FsbENvdW50KS50b0JlKDIpO1xuICAgICAgZXhwZWN0KHNpZ25hdHVyZVNweS5jYWxsc1sxXS5hcmdzKS50b0VxdWFsKFtlZGl0b3IsIG5ldyBQb2ludCgwLCAzKV0pO1xuXG4gICAgICAvLyBXYWl0IGZvciBwcm9taXNlIHRvIGJlIHJlc29sdmVkLlxuICAgICAgYXdhaXQgbmV4dFRpY2soKTtcbiAgICAgIGV4cGVjdChkYXRhdGlwU3B5LmNhbGxDb3VudCkudG9CZSgzKTtcblxuICAgICAgLy8gT25jZSB0aGUgc2lnbmF0dXJlIHJldHVybnMgbnVsbCwgYWJvcnQgdGhlIGZsb3cuXG4gICAgICBzaWduYXR1cmVTcHkuYW5kUmV0dXJuKFByb21pc2UucmVzb2x2ZShudWxsKSk7XG4gICAgICBlZGl0b3Iuc2V0Q3Vyc29yQnVmZmVyUG9zaXRpb24oWzAsIDBdKTtcblxuICAgICAgLy8gTm8gcmVwb3NpdGlvbmluZyB3aGVuIHRoZSBjdXJzb3IgbW92ZXMgdG9vIGZhci5cbiAgICAgIGV4cGVjdChkYXRhdGlwU3B5LmNhbGxDb3VudCkudG9CZSgzKTtcblxuICAgICAgLy8gQ29tcGVuc2F0ZSBmb3IgdGhlIGRlYm91bmNlLlxuICAgICAgamFzbWluZS5DbG9jay50aWNrKDUwMCk7XG4gICAgICBleHBlY3Qoc2lnbmF0dXJlU3B5LmNhbGxDb3VudCkudG9CZSgzKTtcblxuICAgICAgYXdhaXQgbmV4dFRpY2soKTtcbiAgICAgIGV4cGVjdChkYXRhdGlwU3B5LmNhbGxDb3VudCkudG9CZSgzKTtcblxuICAgICAgZWRpdG9yLnNldEN1cnNvckJ1ZmZlclBvc2l0aW9uKFswLCAxXSk7XG4gICAgICBqYXNtaW5lLkNsb2NrLnRpY2soNTAwKTtcbiAgICAgIGV4cGVjdChzaWduYXR1cmVTcHkuY2FsbENvdW50KS50b0JlKDMpO1xuICAgIH0pO1xuICB9KTtcblxuICBpdCgncmVzcG9uZHMgdG8gdHlwaW5nIHRyaWdnZXIgY2hhcmFjdGVycycsICgpID0+IHtcbiAgICB3YWl0c0ZvclByb21pc2UoYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZWRpdG9yID0gYXdhaXQgYXRvbS53b3Jrc3BhY2Uub3BlbigpO1xuICAgICAgLy8gQWN0aXZlIGVkaXRvciBkZWJvdW5jZS5cbiAgICAgIGphc21pbmUuQ2xvY2sudGljayg1MDApO1xuXG4gICAgICBlZGl0b3IuaW5zZXJ0VGV4dCgnYScpO1xuICAgICAgamFzbWluZS5DbG9jay50aWNrKDEpOyAvLyBkZWJvdW5jZVxuICAgICAgY29uc3Qgc2lnbmF0dXJlU3B5ID0gdGVzdFByb3ZpZGVyLmdldFNpZ25hdHVyZUhlbHA7XG4gICAgICBleHBlY3Qoc2lnbmF0dXJlU3B5LmNhbGxDb3VudCkudG9CZSgwKTtcblxuICAgICAgZWRpdG9yLmluc2VydFRleHQoJygnKTtcbiAgICAgIGphc21pbmUuQ2xvY2sudGljaygxKTsgLy8gZGVib3VuY2VcbiAgICAgIGV4cGVjdChzaWduYXR1cmVTcHkuY2FsbENvdW50KS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHNpZ25hdHVyZVNweS5jYWxsc1swXS5hcmdzKS50b0VxdWFsKFtlZGl0b3IsIG5ldyBQb2ludCgwLCAyKV0pO1xuXG4gICAgICAvLyBXZSd2ZSB0ZXN0ZWQgdGhlIHJlZ3VsYXIgZmxvdyBhYm92ZTsgdGVzdCBjYW5jZWxsYXRpb24gdG9vLlxuICAgICAgLyogZ2xvYmFsIEtleWJvYXJkRXZlbnQgKi9cbiAgICAgIGNvbnN0IGVzY2FwZSA9IG5ldyBLZXlib2FyZEV2ZW50KCdrZXlkb3duJyk7XG4gICAgICAvLyBObyBBUGkgdG8gc2V0IGtleUNvZGUgOihcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlc2NhcGUsICdrZXlDb2RlJywge3ZhbHVlOiAyN30pO1xuICAgICAgZWRpdG9yLmdldEVsZW1lbnQoKS5kaXNwYXRjaEV2ZW50KGVzY2FwZSk7XG5cbiAgICAgIGVkaXRvci5pbnNlcnRUZXh0KCd4Jyk7XG4gICAgICBqYXNtaW5lLkNsb2NrLnRpY2soNTAwKTsgLy8gZGVib3VuY2VcbiAgICAgIGV4cGVjdChzaWduYXR1cmVTcHkuY2FsbENvdW50KS50b0JlKDEpO1xuICAgIH0pO1xuICB9KTtcblxuICBpdCgncmVzcG9uZHMgdG8gdHlwaW5nIG92ZXIgYSBzZWxlY3Rpb24nLCAoKSA9PiB7XG4gICAgd2FpdHNGb3JQcm9taXNlKGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVkaXRvciA9IGF3YWl0IGF0b20ud29ya3NwYWNlLm9wZW4oKTtcbiAgICAgIC8vIEFjdGl2ZSBlZGl0b3IgZGVib3VuY2UuXG4gICAgICBqYXNtaW5lLkNsb2NrLnRpY2soNTAwKTtcblxuICAgICAgZWRpdG9yLnNldFRleHQoJyhhYmNkZWYnKTtcbiAgICAgIGphc21pbmUuQ2xvY2sudGljaygxKTsgLy8gZGVib3VuY2VcbiAgICAgIGNvbnN0IHNpZ25hdHVyZVNweSA9IHRlc3RQcm92aWRlci5nZXRTaWduYXR1cmVIZWxwO1xuICAgICAgZXhwZWN0KHNpZ25hdHVyZVNweS5jYWxsQ291bnQpLnRvQmUoMCk7XG5cbiAgICAgIGVkaXRvci5zZXRTZWxlY3RlZEJ1ZmZlclJhbmdlKG5ldyBSYW5nZShbMCwgMF0sIFswLCAxXSkpO1xuICAgICAgZWRpdG9yLmluc2VydFRleHQoJygnKTtcbiAgICAgIGV4cGVjdChlZGl0b3IuZ2V0VGV4dCgpKS50b0JlKCcoYWJjZGVmJyk7XG4gICAgICBqYXNtaW5lLkNsb2NrLnRpY2soMSk7IC8vIGRlYm91bmNlXG4gICAgICBleHBlY3Qoc2lnbmF0dXJlU3B5LmNhbGxDb3VudCkudG9CZSgxKTtcbiAgICAgIGV4cGVjdChzaWduYXR1cmVTcHkuY2FsbHNbMF0uYXJncykudG9FcXVhbChbZWRpdG9yLCBuZXcgUG9pbnQoMCwgMSldKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==