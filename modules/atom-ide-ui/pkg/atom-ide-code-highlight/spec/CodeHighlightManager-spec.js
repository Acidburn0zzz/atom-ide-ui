'use strict';

var cov_2ejfybtrnr = function () {
  var path = '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-code-highlight/spec/CodeHighlightManager-spec.js',
      hash = 'b4370a1661d5e9480c2ab3d499e7aba1a15ea3cf',
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-code-highlight/spec/CodeHighlightManager-spec.js',
    statementMap: {
      '0': {
        start: {
          line: 19,
          column: 0
        },
        end: {
          line: 100,
          column: 3
        }
      },
      '1': {
        start: {
          line: 23,
          column: 2
        },
        end: {
          line: 38,
          column: 5
        }
      },
      '2': {
        start: {
          line: 24,
          column: 4
        },
        end: {
          line: 24,
          column: 28
        }
      },
      '3': {
        start: {
          line: 25,
          column: 4
        },
        end: {
          line: 37,
          column: 7
        }
      },
      '4': {
        start: {
          line: 26,
          column: 6
        },
        end: {
          line: 26,
          column: 43
        }
      },
      '5': {
        start: {
          line: 27,
          column: 6
        },
        end: {
          line: 31,
          column: 8
        }
      },
      '6': {
        start: {
          line: 30,
          column: 42
        },
        end: {
          line: 30,
          column: 61
        }
      },
      '7': {
        start: {
          line: 32,
          column: 6
        },
        end: {
          line: 32,
          column: 36
        }
      },
      '8': {
        start: {
          line: 33,
          column: 6
        },
        end: {
          line: 35,
          column: 8
        }
      },
      '9': {
        start: {
          line: 36,
          column: 6
        },
        end: {
          line: 36,
          column: 38
        }
      },
      '10': {
        start: {
          line: 40,
          column: 2
        },
        end: {
          line: 79,
          column: 5
        }
      },
      '11': {
        start: {
          line: 41,
          column: 19
        },
        end: {
          line: 41,
          column: 46
        }
      },
      '12': {
        start: {
          line: 42,
          column: 16
        },
        end: {
          line: 42,
          column: 62
        }
      },
      '13': {
        start: {
          line: 45,
          column: 4
        },
        end: {
          line: 48,
          column: 7
        }
      },
      '14': {
        start: {
          line: 46,
          column: 6
        },
        end: {
          line: 46,
          column: 30
        }
      },
      '15': {
        start: {
          line: 47,
          column: 6
        },
        end: {
          line: 47,
          column: 37
        }
      },
      '16': {
        start: {
          line: 51,
          column: 4
        },
        end: {
          line: 51,
          column: 50
        }
      },
      '17': {
        start: {
          line: 51,
          column: 19
        },
        end: {
          line: 51,
          column: 48
        }
      },
      '18': {
        start: {
          line: 53,
          column: 4
        },
        end: {
          line: 60,
          column: 7
        }
      },
      '19': {
        start: {
          line: 54,
          column: 6
        },
        end: {
          line: 54,
          column: 44
        }
      },
      '20': {
        start: {
          line: 55,
          column: 6
        },
        end: {
          line: 55,
          column: 54
        }
      },
      '21': {
        start: {
          line: 57,
          column: 6
        },
        end: {
          line: 57,
          column: 46
        }
      },
      '22': {
        start: {
          line: 58,
          column: 6
        },
        end: {
          line: 58,
          column: 30
        }
      },
      '23': {
        start: {
          line: 59,
          column: 6
        },
        end: {
          line: 59,
          column: 36
        }
      },
      '24': {
        start: {
          line: 62,
          column: 4
        },
        end: {
          line: 62,
          column: 50
        }
      },
      '25': {
        start: {
          line: 62,
          column: 19
        },
        end: {
          line: 62,
          column: 48
        }
      },
      '26': {
        start: {
          line: 65,
          column: 4
        },
        end: {
          line: 68,
          column: 7
        }
      },
      '27': {
        start: {
          line: 66,
          column: 6
        },
        end: {
          line: 66,
          column: 54
        }
      },
      '28': {
        start: {
          line: 67,
          column: 6
        },
        end: {
          line: 67,
          column: 36
        }
      },
      '29': {
        start: {
          line: 70,
          column: 4
        },
        end: {
          line: 72,
          column: 6
        }
      },
      '30': {
        start: {
          line: 71,
          column: 6
        },
        end: {
          line: 71,
          column: 68
        }
      },
      '31': {
        start: {
          line: 74,
          column: 4
        },
        end: {
          line: 78,
          column: 7
        }
      },
      '32': {
        start: {
          line: 76,
          column: 6
        },
        end: {
          line: 76,
          column: 28
        }
      },
      '33': {
        start: {
          line: 77,
          column: 6
        },
        end: {
          line: 77,
          column: 46
        }
      },
      '34': {
        start: {
          line: 81,
          column: 2
        },
        end: {
          line: 99,
          column: 5
        }
      },
      '35': {
        start: {
          line: 82,
          column: 19
        },
        end: {
          line: 82,
          column: 46
        }
      },
      '36': {
        start: {
          line: 83,
          column: 16
        },
        end: {
          line: 83,
          column: 62
        }
      },
      '37': {
        start: {
          line: 85,
          column: 4
        },
        end: {
          line: 89,
          column: 7
        }
      },
      '38': {
        start: {
          line: 86,
          column: 6
        },
        end: {
          line: 86,
          column: 29
        }
      },
      '39': {
        start: {
          line: 87,
          column: 6
        },
        end: {
          line: 87,
          column: 30
        }
      },
      '40': {
        start: {
          line: 88,
          column: 6
        },
        end: {
          line: 88,
          column: 37
        }
      },
      '41': {
        start: {
          line: 92,
          column: 4
        },
        end: {
          line: 92,
          column: 50
        }
      },
      '42': {
        start: {
          line: 92,
          column: 19
        },
        end: {
          line: 92,
          column: 48
        }
      },
      '43': {
        start: {
          line: 94,
          column: 4
        },
        end: {
          line: 98,
          column: 7
        }
      },
      '44': {
        start: {
          line: 95,
          column: 6
        },
        end: {
          line: 95,
          column: 29
        }
      },
      '45': {
        start: {
          line: 97,
          column: 6
        },
        end: {
          line: 97,
          column: 46
        }
      }
    },
    fnMap: {
      '0': {
        name: '(anonymous_0)',
        decl: {
          start: {
            line: 19,
            column: 33
          },
          end: {
            line: 19,
            column: 34
          }
        },
        loc: {
          start: {
            line: 19,
            column: 39
          },
          end: {
            line: 100,
            column: 1
          }
        },
        line: 19
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 23,
            column: 13
          },
          end: {
            line: 23,
            column: 14
          }
        },
        loc: {
          start: {
            line: 23,
            column: 19
          },
          end: {
            line: 38,
            column: 3
          }
        },
        line: 23
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 25,
            column: 20
          },
          end: {
            line: 25,
            column: 21
          }
        },
        loc: {
          start: {
            line: 25,
            column: 32
          },
          end: {
            line: 37,
            column: 5
          }
        },
        line: 25
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 30,
            column: 19
          },
          end: {
            line: 30,
            column: 20
          }
        },
        loc: {
          start: {
            line: 30,
            column: 42
          },
          end: {
            line: 30,
            column: 61
          }
        },
        line: 30
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 40,
            column: 42
          },
          end: {
            line: 40,
            column: 43
          }
        },
        loc: {
          start: {
            line: 40,
            column: 48
          },
          end: {
            line: 79,
            column: 3
          }
        },
        line: 40
      },
      '5': {
        name: '(anonymous_5)',
        decl: {
          start: {
            line: 45,
            column: 9
          },
          end: {
            line: 45,
            column: 10
          }
        },
        loc: {
          start: {
            line: 45,
            column: 15
          },
          end: {
            line: 48,
            column: 5
          }
        },
        line: 45
      },
      '6': {
        name: '(anonymous_6)',
        decl: {
          start: {
            line: 51,
            column: 13
          },
          end: {
            line: 51,
            column: 14
          }
        },
        loc: {
          start: {
            line: 51,
            column: 19
          },
          end: {
            line: 51,
            column: 48
          }
        },
        line: 51
      },
      '7': {
        name: '(anonymous_7)',
        decl: {
          start: {
            line: 53,
            column: 9
          },
          end: {
            line: 53,
            column: 10
          }
        },
        loc: {
          start: {
            line: 53,
            column: 15
          },
          end: {
            line: 60,
            column: 5
          }
        },
        line: 53
      },
      '8': {
        name: '(anonymous_8)',
        decl: {
          start: {
            line: 62,
            column: 13
          },
          end: {
            line: 62,
            column: 14
          }
        },
        loc: {
          start: {
            line: 62,
            column: 19
          },
          end: {
            line: 62,
            column: 48
          }
        },
        line: 62
      },
      '9': {
        name: '(anonymous_9)',
        decl: {
          start: {
            line: 65,
            column: 9
          },
          end: {
            line: 65,
            column: 10
          }
        },
        loc: {
          start: {
            line: 65,
            column: 15
          },
          end: {
            line: 68,
            column: 5
          }
        },
        line: 65
      },
      '10': {
        name: '(anonymous_10)',
        decl: {
          start: {
            line: 70,
            column: 20
          },
          end: {
            line: 70,
            column: 21
          }
        },
        loc: {
          start: {
            line: 71,
            column: 6
          },
          end: {
            line: 71,
            column: 68
          }
        },
        line: 71
      },
      '11': {
        name: '(anonymous_11)',
        decl: {
          start: {
            line: 74,
            column: 9
          },
          end: {
            line: 74,
            column: 10
          }
        },
        loc: {
          start: {
            line: 74,
            column: 15
          },
          end: {
            line: 78,
            column: 5
          }
        },
        line: 74
      },
      '12': {
        name: '(anonymous_12)',
        decl: {
          start: {
            line: 81,
            column: 37
          },
          end: {
            line: 81,
            column: 38
          }
        },
        loc: {
          start: {
            line: 81,
            column: 43
          },
          end: {
            line: 99,
            column: 3
          }
        },
        line: 81
      },
      '13': {
        name: '(anonymous_13)',
        decl: {
          start: {
            line: 85,
            column: 9
          },
          end: {
            line: 85,
            column: 10
          }
        },
        loc: {
          start: {
            line: 85,
            column: 15
          },
          end: {
            line: 89,
            column: 5
          }
        },
        line: 85
      },
      '14': {
        name: '(anonymous_14)',
        decl: {
          start: {
            line: 92,
            column: 13
          },
          end: {
            line: 92,
            column: 14
          }
        },
        loc: {
          start: {
            line: 92,
            column: 19
          },
          end: {
            line: 92,
            column: 48
          }
        },
        line: 92
      },
      '15': {
        name: '(anonymous_15)',
        decl: {
          start: {
            line: 94,
            column: 9
          },
          end: {
            line: 94,
            column: 10
          }
        },
        loc: {
          start: {
            line: 94,
            column: 15
          },
          end: {
            line: 98,
            column: 5
          }
        },
        line: 94
      }
    },
    branchMap: {},
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0,
      '33': 0,
      '34': 0,
      '35': 0,
      '36': 0,
      '37': 0,
      '38': 0,
      '39': 0,
      '40': 0,
      '41': 0,
      '42': 0,
      '43': 0,
      '44': 0,
      '45': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0
    },
    b: {},
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

var _asyncToGenerator = _interopRequireDefault(require('async-to-generator'));

var _os = _interopRequireDefault(require('os'));

var _nuclideUri;

function _load_nuclideUri() {
  return _nuclideUri = _interopRequireDefault(require('nuclide-commons/nuclideUri'));
}

var _atom = require('atom');

var _CodeHighlightManager;

function _load_CodeHighlightManager() {
  return _CodeHighlightManager = _interopRequireDefault(require('../lib/CodeHighlightManager'));
}

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */

cov_2ejfybtrnr.s[0]++;


describe('CodeHighlightManager', () => {
  cov_2ejfybtrnr.f[0]++;

  let manager;
  let provider;
  let editor;
  cov_2ejfybtrnr.s[1]++;
  beforeEach(() => {
    cov_2ejfybtrnr.f[1]++;
    cov_2ejfybtrnr.s[2]++;

    jasmine.Clock.useMock();
    cov_2ejfybtrnr.s[3]++;
    waitsForPromise((0, _asyncToGenerator.default)(function* () {
      cov_2ejfybtrnr.f[2]++;
      cov_2ejfybtrnr.s[4]++;

      manager = new (_CodeHighlightManager || _load_CodeHighlightManager()).default();
      cov_2ejfybtrnr.s[5]++;
      provider = {
        priority: 1,
        grammarScopes: ['text.plain.null-grammar'],
        highlight: function (_editor, position) {
          cov_2ejfybtrnr.f[3]++;
          cov_2ejfybtrnr.s[6]++;
          return Promise.resolve([]);
        }
      };
      cov_2ejfybtrnr.s[7]++;
      manager.addProvider(provider);
      cov_2ejfybtrnr.s[8]++;
      editor = yield atom.workspace.open((_nuclideUri || _load_nuclideUri()).default.join(_os.default.tmpdir(), 'test.txt'));
      cov_2ejfybtrnr.s[9]++;
      editor.setText('abc\ndef\nghi');
    }));
  });

  cov_2ejfybtrnr.s[10]++;
  it('updates highlights on cursor move', () => {
    cov_2ejfybtrnr.f[4]++;

    const ranges = (cov_2ejfybtrnr.s[11]++, [new _atom.Range([0, 0], [0, 3])]);
    const spy = (cov_2ejfybtrnr.s[12]++, spyOn(provider, 'highlight').andReturn(ranges));

    // Just opening the editor should trigger highlights.
    cov_2ejfybtrnr.s[13]++;
    runs(() => {
      cov_2ejfybtrnr.f[5]++;
      cov_2ejfybtrnr.s[14]++;

      jasmine.Clock.tick(300);
      cov_2ejfybtrnr.s[15]++;
      expect(spy).toHaveBeenCalled();
    });

    // (once the promise resolves).
    cov_2ejfybtrnr.s[16]++;
    waitsFor(() => {
      cov_2ejfybtrnr.f[6]++;
      cov_2ejfybtrnr.s[17]++;
      return manager._markers.length === 1;
    });

    cov_2ejfybtrnr.s[18]++;
    runs(() => {
      cov_2ejfybtrnr.f[7]++;
      cov_2ejfybtrnr.s[19]++;

      ranges[0] = new _atom.Range([1, 0], [1, 3]);
      cov_2ejfybtrnr.s[20]++;
      editor.setCursorBufferPosition(new _atom.Point(1, 0));
      // Old markers should be cleared immediately.
      cov_2ejfybtrnr.s[21]++;
      expect(manager._markers.length).toBe(0);
      cov_2ejfybtrnr.s[22]++;
      jasmine.Clock.tick(300); // trigger debounce
      cov_2ejfybtrnr.s[23]++;
      expect(spy.callCount).toBe(2);
    });

    cov_2ejfybtrnr.s[24]++;
    waitsFor(() => {
      cov_2ejfybtrnr.f[8]++;
      cov_2ejfybtrnr.s[25]++;
      return manager._markers.length === 1;
    });

    // If we're still inside the range, don't fire a new event.
    cov_2ejfybtrnr.s[26]++;
    runs(() => {
      cov_2ejfybtrnr.f[9]++;
      cov_2ejfybtrnr.s[27]++;

      editor.setCursorBufferPosition(new _atom.Point(1, 1));
      cov_2ejfybtrnr.s[28]++;
      expect(spy.callCount).toBe(2);
    });

    cov_2ejfybtrnr.s[29]++;
    waitsForPromise(() => {
      cov_2ejfybtrnr.f[10]++;
      cov_2ejfybtrnr.s[30]++;
      return atom.workspace.open((_nuclideUri || _load_nuclideUri()).default.join(_os.default.tmpdir(), 'test2.txt'));
    });

    cov_2ejfybtrnr.s[31]++;
    runs(() => {
      cov_2ejfybtrnr.f[11]++;
      cov_2ejfybtrnr.s[32]++;

      // Opening a new editor should clear out old markers.
      jasmine.Clock.tick(1);
      cov_2ejfybtrnr.s[33]++;
      expect(manager._markers.length).toBe(0);
    });
  });

  cov_2ejfybtrnr.s[34]++;
  it('updates highlights on change', () => {
    cov_2ejfybtrnr.f[12]++;

    const ranges = (cov_2ejfybtrnr.s[35]++, [new _atom.Range([0, 0], [0, 1])]);
    const spy = (cov_2ejfybtrnr.s[36]++, spyOn(provider, 'highlight').andReturn(ranges));

    cov_2ejfybtrnr.s[37]++;
    runs(() => {
      cov_2ejfybtrnr.f[13]++;
      cov_2ejfybtrnr.s[38]++;

      editor.insertText('a');
      cov_2ejfybtrnr.s[39]++;
      jasmine.Clock.tick(300); // trigger debounce
      cov_2ejfybtrnr.s[40]++;
      expect(spy).toHaveBeenCalled();
    });

    // Wait for the promise to resolve.
    cov_2ejfybtrnr.s[41]++;
    waitsFor(() => {
      cov_2ejfybtrnr.f[14]++;
      cov_2ejfybtrnr.s[42]++;
      return manager._markers.length === 1;
    });

    cov_2ejfybtrnr.s[43]++;
    runs(() => {
      cov_2ejfybtrnr.f[15]++;
      cov_2ejfybtrnr.s[44]++;

      editor.insertText('b');
      // Clear out immediately.
      cov_2ejfybtrnr.s[45]++;
      expect(manager._markers.length).toBe(0);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNvZGVIaWdobGlnaHRNYW5hZ2VyLXNwZWMuanMiXSwibmFtZXMiOlsiZGVzY3JpYmUiLCJtYW5hZ2VyIiwicHJvdmlkZXIiLCJlZGl0b3IiLCJiZWZvcmVFYWNoIiwiamFzbWluZSIsIkNsb2NrIiwidXNlTW9jayIsIndhaXRzRm9yUHJvbWlzZSIsInByaW9yaXR5IiwiZ3JhbW1hclNjb3BlcyIsImhpZ2hsaWdodCIsIl9lZGl0b3IiLCJwb3NpdGlvbiIsInJlc29sdmUiLCJhZGRQcm92aWRlciIsImF0b20iLCJ3b3Jrc3BhY2UiLCJvcGVuIiwiam9pbiIsInRtcGRpciIsInNldFRleHQiLCJpdCIsInJhbmdlcyIsInNweSIsInNweU9uIiwiYW5kUmV0dXJuIiwicnVucyIsInRpY2siLCJleHBlY3QiLCJ0b0hhdmVCZWVuQ2FsbGVkIiwid2FpdHNGb3IiLCJfbWFya2VycyIsImxlbmd0aCIsInNldEN1cnNvckJ1ZmZlclBvc2l0aW9uIiwidG9CZSIsImNhbGxDb3VudCIsImluc2VydFRleHQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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LFFBQU4sRUFBZ0IsV0FBaEIsRUFBNkJ3QixTQUE3QixDQUF1Q0gsTUFBdkMsQ0FBTixDQUFOOztBQUZ1QztBQUl2Q0ksU0FBSyxNQUFNO0FBQUE7QUFBQTs7QUFDVHhCLGFBQU9rQyxVQUFQLENBQWtCLEdBQWxCO0FBRFM7QUFFVGhDLGNBQVFDLEtBQVIsQ0FBY3NCLElBQWQsQ0FBbUIsR0FBbkIsRUFGUyxDQUVnQjtBQUZoQjtBQUdUQyxhQUFPTCxHQUFQLEVBQVlNLGdCQUFaO0FBQ0QsS0FKRDs7QUFNQTtBQVZ1QztBQVd2Q0MsYUFBUyxNQUFNO0FBQUE7QUFBQTtBQUFBLHFCQUFRQyxRQUFSLENBQWlCQyxNQUFqQixLQUE0QixDQUE1QjtBQUE2QixLQUE1Qzs7QUFYdUM7QUFhdkNOLFNBQUssTUFBTTtBQUFBO0FBQUE7O0FBQ1R4QixhQUFPa0MsVUFBUCxDQUFrQixHQUFsQjtBQUNBO0FBRlM7QUFHVFIsYUFBTzVCLFFBQVErQixRQUFSLENBQWlCQyxNQUF4QixFQUFnQ0UsSUFBaEMsQ0FBcUMsQ0FBckM7QUFDRCxLQUpEO0FBS0QsR0FsQkQ7QUFtQkQsQ0FqRkQiLCJmaWxlIjoiQ29kZUhpZ2hsaWdodE1hbmFnZXItc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE3LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XG4gKiBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluIHRoZSBzYW1lIGRpcmVjdG9yeS5cbiAqXG4gKiBAZmxvd1xuICogQGZvcm1hdFxuICovXG5cbmltcG9ydCBvcyBmcm9tICdvcyc7XG5pbXBvcnQgbnVjbGlkZVVyaSBmcm9tICdudWNsaWRlLWNvbW1vbnMvbnVjbGlkZVVyaSc7XG5pbXBvcnQge1BvaW50LCBSYW5nZX0gZnJvbSAnYXRvbSc7XG5cbmltcG9ydCBDb2RlSGlnaGxpZ2h0TWFuYWdlciBmcm9tICcuLi9saWIvQ29kZUhpZ2hsaWdodE1hbmFnZXInO1xuXG5kZXNjcmliZSgnQ29kZUhpZ2hsaWdodE1hbmFnZXInLCAoKSA9PiB7XG4gIGxldCBtYW5hZ2VyO1xuICBsZXQgcHJvdmlkZXI7XG4gIGxldCBlZGl0b3I7XG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGphc21pbmUuQ2xvY2sudXNlTW9jaygpO1xuICAgIHdhaXRzRm9yUHJvbWlzZShhc3luYyAoKSA9PiB7XG4gICAgICBtYW5hZ2VyID0gbmV3IENvZGVIaWdobGlnaHRNYW5hZ2VyKCk7XG4gICAgICBwcm92aWRlciA9IHtcbiAgICAgICAgcHJpb3JpdHk6IDEsXG4gICAgICAgIGdyYW1tYXJTY29wZXM6IFsndGV4dC5wbGFpbi5udWxsLWdyYW1tYXInXSxcbiAgICAgICAgaGlnaGxpZ2h0OiAoX2VkaXRvciwgcG9zaXRpb24pID0+IFByb21pc2UucmVzb2x2ZShbXSksXG4gICAgICB9O1xuICAgICAgbWFuYWdlci5hZGRQcm92aWRlcihwcm92aWRlcik7XG4gICAgICBlZGl0b3IgPSBhd2FpdCBhdG9tLndvcmtzcGFjZS5vcGVuKFxuICAgICAgICBudWNsaWRlVXJpLmpvaW4ob3MudG1wZGlyKCksICd0ZXN0LnR4dCcpLFxuICAgICAgKTtcbiAgICAgIGVkaXRvci5zZXRUZXh0KCdhYmNcXG5kZWZcXG5naGknKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgaXQoJ3VwZGF0ZXMgaGlnaGxpZ2h0cyBvbiBjdXJzb3IgbW92ZScsICgpID0+IHtcbiAgICBjb25zdCByYW5nZXMgPSBbbmV3IFJhbmdlKFswLCAwXSwgWzAsIDNdKV07XG4gICAgY29uc3Qgc3B5ID0gc3B5T24ocHJvdmlkZXIsICdoaWdobGlnaHQnKS5hbmRSZXR1cm4ocmFuZ2VzKTtcblxuICAgIC8vIEp1c3Qgb3BlbmluZyB0aGUgZWRpdG9yIHNob3VsZCB0cmlnZ2VyIGhpZ2hsaWdodHMuXG4gICAgcnVucygoKSA9PiB7XG4gICAgICBqYXNtaW5lLkNsb2NrLnRpY2soMzAwKTtcbiAgICAgIGV4cGVjdChzcHkpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIC8vIChvbmNlIHRoZSBwcm9taXNlIHJlc29sdmVzKS5cbiAgICB3YWl0c0ZvcigoKSA9PiBtYW5hZ2VyLl9tYXJrZXJzLmxlbmd0aCA9PT0gMSk7XG5cbiAgICBydW5zKCgpID0+IHtcbiAgICAgIHJhbmdlc1swXSA9IG5ldyBSYW5nZShbMSwgMF0sIFsxLCAzXSk7XG4gICAgICBlZGl0b3Iuc2V0Q3Vyc29yQnVmZmVyUG9zaXRpb24obmV3IFBvaW50KDEsIDApKTtcbiAgICAgIC8vIE9sZCBtYXJrZXJzIHNob3VsZCBiZSBjbGVhcmVkIGltbWVkaWF0ZWx5LlxuICAgICAgZXhwZWN0KG1hbmFnZXIuX21hcmtlcnMubGVuZ3RoKS50b0JlKDApO1xuICAgICAgamFzbWluZS5DbG9jay50aWNrKDMwMCk7IC8vIHRyaWdnZXIgZGVib3VuY2VcbiAgICAgIGV4cGVjdChzcHkuY2FsbENvdW50KS50b0JlKDIpO1xuICAgIH0pO1xuXG4gICAgd2FpdHNGb3IoKCkgPT4gbWFuYWdlci5fbWFya2Vycy5sZW5ndGggPT09IDEpO1xuXG4gICAgLy8gSWYgd2UncmUgc3RpbGwgaW5zaWRlIHRoZSByYW5nZSwgZG9uJ3QgZmlyZSBhIG5ldyBldmVudC5cbiAgICBydW5zKCgpID0+IHtcbiAgICAgIGVkaXRvci5zZXRDdXJzb3JCdWZmZXJQb3NpdGlvbihuZXcgUG9pbnQoMSwgMSkpO1xuICAgICAgZXhwZWN0KHNweS5jYWxsQ291bnQpLnRvQmUoMik7XG4gICAgfSk7XG5cbiAgICB3YWl0c0ZvclByb21pc2UoKCkgPT5cbiAgICAgIGF0b20ud29ya3NwYWNlLm9wZW4obnVjbGlkZVVyaS5qb2luKG9zLnRtcGRpcigpLCAndGVzdDIudHh0JykpLFxuICAgICk7XG5cbiAgICBydW5zKCgpID0+IHtcbiAgICAgIC8vIE9wZW5pbmcgYSBuZXcgZWRpdG9yIHNob3VsZCBjbGVhciBvdXQgb2xkIG1hcmtlcnMuXG4gICAgICBqYXNtaW5lLkNsb2NrLnRpY2soMSk7XG4gICAgICBleHBlY3QobWFuYWdlci5fbWFya2Vycy5sZW5ndGgpLnRvQmUoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGl0KCd1cGRhdGVzIGhpZ2hsaWdodHMgb24gY2hhbmdlJywgKCkgPT4ge1xuICAgIGNvbnN0IHJhbmdlcyA9IFtuZXcgUmFuZ2UoWzAsIDBdLCBbMCwgMV0pXTtcbiAgICBjb25zdCBzcHkgPSBzcHlPbihwcm92aWRlciwgJ2hpZ2hsaWdodCcpLmFuZFJldHVybihyYW5nZXMpO1xuXG4gICAgcnVucygoKSA9PiB7XG4gICAgICBlZGl0b3IuaW5zZXJ0VGV4dCgnYScpO1xuICAgICAgamFzbWluZS5DbG9jay50aWNrKDMwMCk7IC8vIHRyaWdnZXIgZGVib3VuY2VcbiAgICAgIGV4cGVjdChzcHkpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIC8vIFdhaXQgZm9yIHRoZSBwcm9taXNlIHRvIHJlc29sdmUuXG4gICAgd2FpdHNGb3IoKCkgPT4gbWFuYWdlci5fbWFya2Vycy5sZW5ndGggPT09IDEpO1xuXG4gICAgcnVucygoKSA9PiB7XG4gICAgICBlZGl0b3IuaW5zZXJ0VGV4dCgnYicpO1xuICAgICAgLy8gQ2xlYXIgb3V0IGltbWVkaWF0ZWx5LlxuICAgICAgZXhwZWN0KG1hbmFnZXIuX21hcmtlcnMubGVuZ3RoKS50b0JlKDApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19